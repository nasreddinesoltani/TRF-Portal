import React, { useCallback, useEffect, useMemo, useState } from "react";import React from "react";import React, { useCallback, useEffect, useMemo, useState } from "react";const ClubLogoPreview = ({ name, code, logoUrl }) => {                      className={`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${clubStatusClasses}`}

import { useNavigate, useParams } from "react-router-dom";

import { toast } from "react-toastify";

import { useAuth } from "../contexts/AuthContext";

import { Button } from "../components/ui/button";const ClubDetail = () => {import { useNavigate, useParams } from "react-router-dom";

import { Input } from "../components/ui/input";

import { Label } from "../components/ui/label";  return <div />;

import { Select } from "../components/ui/select";

import { DataGrid } from "../components/DataGrid";};import { toast } from "react-toastify";  const initials = getClubInitials(name, code);                    >



const apiBase = "http://localhost:5000";



const defaultAthleteBuckets = {export default ClubDetail;import { useAuth } from "../contexts/AuthContext";

  active: [],

  inactive: [],

  pending: [],import { Button } from "../components/ui/button";  const hasLogo = Boolean(logoUrl);                      {club?.isActive ? "Active" : "Inactive"}

  transferred: [],

};import { Input } from "../components/ui/input";



const defaultCounts = {import { Label } from "../components/ui/label";                    </span>

  active: 0,

  inactive: 0,import { Select } from "../components/ui/select";

  pending: 0,

  transferred: 0,import { DataGrid } from "../components/DataGrid";  return (                    <span className="inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">

};



const statusBadgeStyles = {

  active: "bg-emerald-50 text-emerald-700 ring-emerald-200",const apiBase = "http://localhost:5000";    <div className="relative flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-slate-200 bg-white">                      {totalAthletes} total athletes

  inactive: "bg-slate-100 text-slate-600 ring-slate-200",

  pending: "bg-amber-50 text-amber-600 ring-amber-200",

  transferred: "bg-indigo-50 text-indigo-600 ring-indigo-200",

  default: "bg-slate-100 text-slate-600 ring-slate-200",const defaultAthleteBuckets = {      {hasLogo ? (                    </span>

};

  active: [],

const TYPE_OPTIONS = [

  { value: "club", label: "Club" },  inactive: [],        <>                    <span className="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-600">

  { value: "country", label: "Country" },

  { value: "centre_de_promotion", label: "Centre de promotion" },  pending: [],

  { value: "ecole_federale", label: "Ecole federale" },

];  transferred: [],          <img                      {activeRate}% active rate



const TYPE_LABELS = TYPE_OPTIONS.reduce((acc, option) => {};

  acc[option.value] = option.label;

  return acc;            src={logoUrl}                    </span>

}, {});

const defaultCounts = {

const ATHLETE_STATUS_SUMMARY = [

  {  active: 0,            alt={`${name || "Club"} logo`}                  </div>

    key: "active",

    label: "Active Athletes",  inactive: 0,

    cardClasses: "border-emerald-200 bg-emerald-50",

    badgeClasses: "bg-emerald-500",  pending: 0,            className="h-full w-full object-cover"                </div>

  },

  {  transferred: 0,

    key: "inactive",

    label: "Inactive Athletes",};            onError={(event) => {              </div>

    cardClasses: "border-slate-200 bg-white",

    badgeClasses: "bg-slate-400",

  },

  {const statusBadgeStyles = {              event.currentTarget.style.display = "none";              <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">

    key: "pending",

    label: "Pending Athletes",  active: "bg-emerald-50 text-emerald-700 ring-emerald-200",

    cardClasses: "border-amber-200 bg-amber-50",

    badgeClasses: "bg-amber-500",  inactive: "bg-slate-100 text-slate-600 ring-slate-200",              const fallback = event.currentTarget.nextElementSibling;                <DetailItem label="Club Code">{club?.code}</DetailItem>

  },

  {  pending: "bg-amber-50 text-amber-600 ring-amber-200",

    key: "transferred",

    label: "Transferred Athletes",  transferred: "bg-indigo-50 text-indigo-600 ring-indigo-200",              if (fallback) {                <DetailItem label="Email">

    cardClasses: "border-indigo-200 bg-indigo-50",

    badgeClasses: "bg-indigo-500",  default: "bg-slate-100 text-slate-600 ring-slate-200",

  },

];};                fallback.classList.remove("hidden");                  {club?.email ? (



const ATHLETE_EMPTY_MESSAGES = {

  active: "No active athletes found",

  inactive: "No inactive athletes",const TYPE_OPTIONS = [              }                    <a

  pending: "No pending athletes",

  transferred: "No transferred athletes",  { value: "club", label: "Club" },

};

  { value: "country", label: "Country" },            }}                      href={`mailto:${club.email}`}

const getClubInitials = (name, code) => {

  if (name) {  { value: "centre_de_promotion", label: "Centre de promotion" },

    const letters = name

      .split(/\s+/)  { value: "ecole_federale", label: "Ecole federale" },          />                      className="text-blue-600 hover:underline"

      .filter(Boolean)

      .map((segment) => segment[0])];

      .join("");

          <span className="hidden text-sm font-semibold text-slate-500">                    >

    if (letters) {

      return letters.slice(0, 2).toUpperCase();const TYPE_LABELS = TYPE_OPTIONS.reduce((acc, option) => {

    }

  }  acc[option.value] = option.label;            {initials}                      {club.email}



  if (code) {  return acc;

    return code.slice(0, 2).toUpperCase();

  }}, {});          </span>                    </a>



  return "CL";

};

const ATHLETE_STATUS_SUMMARY = [        </>                  ) : null}

const ClubLogoPreview = ({ name, code, logoUrl }) => {

  const initials = getClubInitials(name, code);  {

  const hasLogo = Boolean(logoUrl);

    key: "active",      ) : (                </DetailItem>

  return (

    <div className="relative flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-slate-200 bg-white">    label: "Active Athletes",

      {hasLogo ? (

        <>    cardClasses: "border-emerald-200 bg-emerald-50",        <span className="text-lg font-semibold text-slate-500">                <DetailItem label="Phone">{club?.phone}</DetailItem>

          <img

            src={logoUrl}    badgeClasses: "bg-emerald-500",

            alt={`${name || "Club"} logo`}

            className="h-full w-full object-cover"  },          {initials}                <DetailItem label="City">{club?.city}</DetailItem>

            onError={(event) => {

              event.currentTarget.style.display = "none";  {

              const fallback = event.currentTarget.nextElementSibling;

              if (fallback) {    key: "inactive",        </span>                <DetailItem label="Address">

                fallback.classList.remove("hidden");

              }    label: "Inactive Athletes",

            }}

          />    cardClasses: "border-slate-200 bg-white",      )}                  {club?.address ? (

          <span className="hidden text-sm font-semibold text-slate-500">

            {initials}    badgeClasses: "bg-slate-400",

          </span>

        </>  },    </div>                    <span className="block break-words">{club.address}</span>

      ) : (

        <span className="text-lg font-semibold text-slate-500">  {

          {initials}

        </span>    key: "pending",  );                  ) : null}

      )}

    </div>    label: "Pending Athletes",

  );

};    cardClasses: "border-amber-200 bg-amber-50",};                </DetailItem>



const DetailItem = ({ label, children }) => (    badgeClasses: "bg-amber-500",

  <div className="space-y-1">

    <span className="text-xs font-semibold uppercase tracking-wide text-slate-500">  },                <DetailItem label="Parent Club">

      {label}

    </span>  {

    <div className="text-sm text-slate-900">{children ?? "—"}</div>

  </div>    key: "transferred",const DetailItem = ({ label, children }) => (                  {parentClubDisplay ? (

);

    label: "Transferred Athletes",

const ClubDetail = () => {

  const { clubId: routeClubId } = useParams();    cardClasses: "border-indigo-200 bg-indigo-50",  <div className="space-y-1">                    <span className="flex flex-wrap items-center gap-2">

  const navigate = useNavigate();

  const { token, user } = useAuth();    badgeClasses: "bg-indigo-500",



  const [loading, setLoading] = useState(true);  },    <span className="text-xs font-semibold uppercase tracking-wide text-slate-500">                      <span>{parentClubDisplay}</span>

  const [club, setClub] = useState(null);

  const [athletes, setAthletes] = useState(defaultAthleteBuckets);];

  const [counts, setCounts] = useState(defaultCounts);

  const [permissions, setPermissions] = useState({      {label}                      {parentClubIsActive !== null ? (

    canManageAthletes: false,

    canDecideTransfers: false,const ATHLETE_EMPTY_MESSAGES = {

    canApproveDeletions: false,

    canRequestDeletions: false,  active: "No active athletes found",    </span>                        <span

  });

  const [searchTerm, setSearchTerm] = useState("");  inactive: "No inactive athletes",

  const [pendingTransfers, setPendingTransfers] = useState([]);

  const [pendingDeletionRequests, setPendingDeletionRequests] = useState([]);  pending: "No pending athletes",    <div className="text-sm text-slate-900">{children ?? "—"}</div>                          className={`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${parentClubIsActive ? "bg-emerald-100 text-emerald-700" : "bg-slate-100 text-slate-600"}`}

  const [statusUpdating, setStatusUpdating] = useState(false);

  const [clubs, setClubs] = useState([]);  transferred: "No transferred athletes",

  const [transferDialog, setTransferDialog] = useState({

    isOpen: false,};  </div>                        >

    athlete: null,

    targetClubId: "",

    note: "",

    submitting: false,const getClubInitials = (name, code) => {);                          {parentClubIsActive ? "Active" : "Inactive"}

  });

  const [deleteDialog, setDeleteDialog] = useState({  if (name) {

    isOpen: false,

    athlete: null,    const letters = name                        </span>

    reason: "",

    submitting: false,      .split(/\s+/)

  });

  const [editingAthlete, setEditingAthlete] = useState(null);      .filter(Boolean)const ClubDetail = () => {                      ) : null}

  const [editForm, setEditForm] = useState({

    firstName: "",      .map((segment) => segment[0])

    lastName: "",

    firstNameAr: "",      .join("");  const { clubId: routeClubId } = useParams();                    </span>

    lastNameAr: "",

    birthDate: "",

    gender: "",

    cin: "",    if (letters) {  const navigate = useNavigate();                  ) : null}

    passportNumber: "",

    clubId: "",      return letters.slice(0, 2).toUpperCase();

  });

  const [editSubmitting, setEditSubmitting] = useState(false);    }  const { token, user } = useAuth();                </DetailItem>



  const isAdmin = user?.role === "admin";  }



  const effectiveClubId = useMemo(() => {                <DetailItem label="Primary Contact">{contactName}</DetailItem>

    if (routeClubId && routeClubId !== "mine") {

      return routeClubId;  if (code) {

    }

    return code.slice(0, 2).toUpperCase();  const [loading, setLoading] = useState(true);                <DetailItem label="Contact Phone">{contactPhone}</DetailItem>

    if (routeClubId === "mine" && user?.clubId) {

      return user.clubId;  }

    }

  const [club, setClub] = useState(null);                <DetailItem label="Season Activation">

    return routeClubId || user?.clubId || null;

  }, [routeClubId, user?.clubId]);  return "CL";



  const detailEndpointId = routeClubId === "mine" ? "mine" : effectiveClubId;};  const [athletes, setAthletes] = useState(defaultAthleteBuckets);                  {seasonActivationSummary}



  const formatDisplayDate = useCallback((value) => {

    if (!value) {

      return null;const ClubLogoPreview = ({ name, code, logoUrl }) => {  const [counts, setCounts] = useState(defaultCounts);                </DetailItem>

    }

  const initials = getClubInitials(name, code);

    const parsed = new Date(value);

    if (Number.isNaN(parsed.getTime())) {  const hasLogo = Boolean(logoUrl);  const [permissions, setPermissions] = useState({              </div>

      return null;

    }



    return parsed.toLocaleDateString(undefined, {  return (    canManageAthletes: false,            </div>

      year: "numeric",

      month: "short",    <div className="relative flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-slate-200 bg-white">

      day: "numeric",

    });      {hasLogo ? (    canDecideTransfers: false,            <div className="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">

  }, []);

        <>

  const renderAthleteSummary = useCallback(

    (athlete) => {          <img    canApproveDeletions: false,              {membershipSummaryCards.map((card) => (

      const birthDateLabel = formatDisplayDate(athlete.birthDate);

            src={logoUrl}

      return (

        <div className="space-y-1 leading-tight">            alt={`${name || "Club"} logo`}    canRequestDeletions: false,                <div

          <p className="font-semibold text-slate-900">

            {athlete.fullName || "Unnamed athlete"}            className="h-full w-full object-cover"

          </p>

          <p className="text-sm text-slate-500">{athlete.fullNameAr || "—"}</p>            onError={(event) => {  });                  key={card.key}

          {birthDateLabel ? (

            <p className="text-xs text-slate-400">Born {birthDateLabel}</p>              event.currentTarget.style.display = "none";

          ) : null}

        </div>              const fallback = event.currentTarget.nextElementSibling;  const [searchTerm, setSearchTerm] = useState("");                  className={`rounded-2xl border ${card.cardClasses} p-5 shadow-sm`}

      );

    },              if (fallback) {

    [formatDisplayDate]

  );                fallback.classList.remove("hidden");  const [pendingTransfers, setPendingTransfers] = useState([]);                >



  const renderIdentifierBadges = useCallback((athlete) => {              }

    const badges = [];

            }}  const [pendingDeletionRequests, setPendingDeletionRequests] = useState([]);                  <p className="text-sm font-medium text-slate-600">

    if (athlete.licenseNumber) {

      badges.push(          />

        <span

          key="license"          <span className="hidden text-sm font-semibold text-slate-500">  const [statusUpdating, setStatusUpdating] = useState(false);                    {card.label}

          className="inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-xs font-medium text-white"

        >            {initials}

          License {athlete.licenseNumber}

        </span>          </span>  const [clubs, setClubs] = useState([]);                  </p>

      );

    }        </>



    if (athlete.cin) {      ) : (  const [transferDialog, setTransferDialog] = useState({                  <div className="mt-3 flex items-end gap-2">

      badges.push(

        <span        <span className="text-lg font-semibold text-slate-500">

          key="cin"

          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"          {initials}    isOpen: false,                    <span className="text-3xl font-semibold text-slate-900">

        >

          CIN {athlete.cin}        </span>

        </span>

      );      )}    athlete: null,                      {card.count}

    }

    </div>

    if (athlete.passportNumber) {

      badges.push(  );    targetClubId: "",                    </span>

        <span

          key="passport"};

          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"

        >    note: "",                    <span className="text-xs text-slate-500">

          Passport {athlete.passportNumber}

        </span>const DetailItem = ({ label, children }) => (

      );

    }  <div className="space-y-1">    submitting: false,                      {card.percent}% of roster



    if (!badges.length) {    <span className="text-xs font-semibold uppercase tracking-wide text-slate-500">

      badges.push(

        <span key="empty" className="text-sm text-slate-400">      {label}  });                    </span>

          No identifiers

        </span>    </span>

      );

    }    <div className="text-sm text-slate-900">{children ?? "—"}</div>  const [deleteDialog, setDeleteDialog] = useState({                  </div>



    return <div className="flex flex-wrap gap-2">{badges}</div>;  </div>

  }, []);

);    isOpen: false,                  <div className="mt-4 h-2 rounded-full bg-white/70">

  const renderStatusBadge = useCallback(

    (athlete) => {

      const normalizedStatus = (

        athlete.membershipStatus || "inactive"const ClubDetail = () => {    athlete: null,                    <div

      ).toLowerCase();

      const badgeClasses =  const { clubId: routeClubId } = useParams();

        statusBadgeStyles[normalizedStatus] || statusBadgeStyles.default;

      const displayLabel = normalizedStatus  const navigate = useNavigate();    reason: "",                      className={`h-full rounded-full ${card.badgeClasses}`}

        .split(/[\s_-]+/)

        .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))  const { token, user } = useAuth();

        .join(" ");

    submitting: false,                      style={{ width: `${card.percent}%` }}

      const seasonLabel = athlete.membershipSeason

        ? `Season ${athlete.membershipSeason}`  const [loading, setLoading] = useState(true);

        : null;

      const memberSince = formatDisplayDate(athlete.membershipStartDate);  const [club, setClub] = useState(null);  });                    />



      return (  const [athletes, setAthletes] = useState(defaultAthleteBuckets);

        <div className="space-y-1">

          <span  const [counts, setCounts] = useState(defaultCounts);  const [editingAthlete, setEditingAthlete] = useState(null);                  </div>

            className={`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ring-1 ring-inset ${badgeClasses}`}

          >  const [permissions, setPermissions] = useState({

            {displayLabel}

          </span>    canManageAthletes: false,  const [editForm, setEditForm] = useState({                </div>

          {seasonLabel ? (

            <p className="text-xs text-slate-500">{seasonLabel}</p>    canDecideTransfers: false,

          ) : null}

          {memberSince ? (    canApproveDeletions: false,    firstName: "",              ))}

            <p className="text-xs text-slate-400">Member since {memberSince}</p>

          ) : null}    canRequestDeletions: false,

        </div>

      );  });    lastName: "",            </div>

    },

    [formatDisplayDate]  const [searchTerm, setSearchTerm] = useState("");

  );

  const [pendingTransfers, setPendingTransfers] = useState([]);    firstNameAr: "",            <div className="mt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">

  const loadClubDetails = useCallback(async () => {

    if (!token || !detailEndpointId) {  const [pendingDeletionRequests, setPendingDeletionRequests] = useState([]);

      return;

    }  const [statusUpdating, setStatusUpdating] = useState(false);    lastNameAr: "",              <p className="text-sm text-slate-500">



    setLoading(true);  const [clubs, setClubs] = useState([]);



    try {  const [transferDialog, setTransferDialog] = useState({    birthDate: "",                Displaying {displayedAthletesCount} of {totalAthletes} athletes

      const response = await fetch(

        `${apiBase}/api/clubs/${detailEndpointId}/details`,    isOpen: false,

        {

          headers: {    athlete: null,    gender: "",                across all statuses.

            Authorization: `Bearer ${token}`,

          },    targetClubId: "",

        }

      );    note: "",    cin: "",              </p>



      if (!response.ok) {    submitting: false,

        const data = await response.json().catch(() => ({}));

        throw new Error(data.message || "Failed to load club details");  });    passportNumber: "",              <div className="flex flex-col gap-3 sm:flex-row sm:items-center">

      }

  const [deleteDialog, setDeleteDialog] = useState({

      const data = await response.json();

    isOpen: false,    clubId: "",                <Input

      setClub(data.club || null);

      setAthletes(data.athletes || defaultAthleteBuckets);    athlete: null,

      setCounts({ ...defaultCounts, ...(data.counts || {}) });

      setPermissions((previous) => ({    reason: "",  });                  placeholder="Search athletes by name, license, CIN..."

        ...previous,

        ...(data.permissions || {}),    submitting: false,

      }));

      setPendingTransfers(  });  const [editSubmitting, setEditSubmitting] = useState(false);                  value={searchTerm}

        Array.isArray(data.pendingTransfers) ? data.pendingTransfers : []

      );  const [editingAthlete, setEditingAthlete] = useState(null);

      setPendingDeletionRequests(

        Array.isArray(data.pendingDeletionRequests)  const [editForm, setEditForm] = useState({                  onChange={(event) => setSearchTerm(event.target.value)}

          ? data.pendingDeletionRequests

          : []    firstName: "",

      );

    } catch (error) {    lastName: "",  const isAdmin = user?.role === "admin";                  className="w-full sm:w-72"

      console.error("Failed to load club details", error);

      toast.error(error.message);    firstNameAr: "",

    } finally {

      setLoading(false);    lastNameAr: "",                />

    }

  }, [detailEndpointId, token]);    birthDate: "",



  useEffect(() => {    gender: "",  const effectiveClubId = useMemo(() => {                <Button

    loadClubDetails();

  }, [loadClubDetails]);    cin: "",



  const loadClubs = useCallback(async () => {    passportNumber: "",    if (routeClubId && routeClubId !== "mine") {                  variant="outline"

    if (!token || !permissions.canManageAthletes) {

      return;    clubId: "",

    }

  });      return routeClubId;                  onClick={() => loadClubDetails()}

    try {

      const response = await fetch(`${apiBase}/api/clubs?isActive=true`, {  const [editSubmitting, setEditSubmitting] = useState(false);

        headers: {

          Authorization: `Bearer ${token}`,    }                  disabled={loading}

        },

      });  const isAdmin = user?.role === "admin";



      if (!response.ok) {                >

        const data = await response.json().catch(() => ({}));

        throw new Error(data.message || "Failed to load clubs");  const effectiveClubId = useMemo(() => {

      }

    if (routeClubId && routeClubId !== "mine") {    if (routeClubId === "mine" && user?.clubId) {                  Refresh

      const data = await response.json();

      setClubs(Array.isArray(data) ? data : []);      return routeClubId;

    } catch (error) {

      console.error("Failed to retrieve clubs", error);    }      return user.clubId;                </Button>

      toast.error(error.message);

    }

  }, [permissions.canManageAthletes, token]);

    if (routeClubId === "mine" && user?.clubId) {    }              </div>

  useEffect(() => {

    loadClubs();      return user.clubId;

  }, [loadClubs]);

    }            </div>

  const filterAthletes = useCallback(

    (list) => {

      if (!Array.isArray(list) || !list.length) {

        return [];    return routeClubId || user?.clubId || null;    return routeClubId || user?.clubId || null;          </div>

      }

  }, [routeClubId, user?.clubId]);

      if (!searchTerm.trim()) {

        return list;  }, [routeClubId, user?.clubId]);

      }

  const detailEndpointId = routeClubId === "mine" ? "mine" : effectiveClubId;

      const needle = searchTerm.trim().toLowerCase();

          {athleteSections.map((section) => (

      return list.filter((athlete) => {

        const fields = [  const formatDisplayDate = useCallback((value) => {

          athlete.fullName,

          athlete.fullNameAr,    if (!value) {  const detailEndpointId = routeClubId === "mine" ? "mine" : effectiveClubId;            <section key={section.key} className="space-y-4">

          athlete.licenseNumber,

          athlete.cin,      return null;

          athlete.passportNumber,

        ];    }              <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">



        return fields.some((value) =>

          value ? value.toString().toLowerCase().includes(needle) : false

        );    const parsed = new Date(value);  const formatDisplayDate = useCallback((value) => {                <div className="flex items-center gap-3">

      });

    },    if (Number.isNaN(parsed.getTime())) {

    [searchTerm]

  );      return null;    if (!value) {                  <h2 className="text-xl font-semibold text-slate-900">



  const filteredAthletes = useMemo(    }

    () => ({

      active: filterAthletes(athletes.active),      return null;                    {section.title}

      inactive: filterAthletes(athletes.inactive),

      pending: filterAthletes(athletes.pending),    return parsed.toLocaleDateString(undefined, {

      transferred: filterAthletes(athletes.transferred),

    }),      year: "numeric",    }                  </h2>

    [athletes, filterAthletes]

  );      month: "short",



  const updateEditFormField = useCallback((field, value) => {      day: "numeric",                  <span

    setEditForm((previous) => ({

      ...previous,    });

      [field]: value,

    }));  }, []);    const parsed = new Date(value);                    className={`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold text-white ${section.badgeClasses}`}

  }, []);



  const openEditDialog = useCallback(

    (athlete) => {  const renderAthleteSummary = useCallback(    if (Number.isNaN(parsed.getTime())) {                  >

      if (!athlete) {

        return;    (athlete) => {

      }

      const birthDateLabel = formatDisplayDate(athlete.birthDate);      return null;                    {section.count} total

      let birthDateValue = "";

      if (athlete.birthDate) {

        const parsed = new Date(athlete.birthDate);

        if (!Number.isNaN(parsed.getTime())) {      return (    }                  </span>

          birthDateValue = parsed.toISOString().slice(0, 10);

        }        <div className="space-y-1 leading-tight">

      }

          <p className="font-semibold text-slate-900">                </div>

      const resolvedClubId =

        athlete.membershipClubId || effectiveClubId || "";            {athlete.fullName || "Unnamed athlete"}



      setEditingAthlete(athlete);          </p>    return parsed.toLocaleDateString(undefined, {                <span className="text-sm text-slate-500">

      setEditForm({

        firstName: athlete.firstName || "",          <p className="text-sm text-slate-500">{athlete.fullNameAr || "—"}</p>

        lastName: athlete.lastName || "",

        firstNameAr: athlete.firstNameAr || "",          {birthDateLabel ? (      year: "numeric",                  {section.data.length} shown

        lastNameAr: athlete.lastNameAr || "",

        birthDate: birthDateValue,            <p className="text-xs text-slate-400">Born {birthDateLabel}</p>

        gender: athlete.gender || "",

        cin: athlete.cin || "",          ) : null}      month: "short",                </span>

        passportNumber: athlete.passportNumber || "",

        clubId: resolvedClubId,        </div>

      });

    },      );      day: "numeric",              </div>

    [effectiveClubId]

  );    },



  const closeEditDialog = useCallback(() => {    [formatDisplayDate]    });              <div className="rounded-3xl border border-gray-200 bg-white p-3 shadow-sm">

    setEditingAthlete(null);

    setEditForm({  );

      firstName: "",

      lastName: "",  }, []);                <DataGrid

      firstNameAr: "",

      lastNameAr: "",  const renderIdentifierBadges = useCallback((athlete) => {

      birthDate: "",

      gender: "",    const badges = [];                  data={section.data}

      cin: "",

      passportNumber: "",

      clubId: "",

    });    if (athlete.licenseNumber) {  const renderAthleteSummary = useCallback(                  columns={baseColumns}

    setEditSubmitting(false);

  }, []);      badges.push(



  const handleEditSubmit = useCallback(        <span    (athlete) => {                  gridId={section.gridId}

    async (event) => {

      event.preventDefault();          key="license"



      if (!token || !editingAthlete) {          className="inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-xs font-medium text-white"      const birthDateLabel = formatDisplayDate(athlete.birthDate);                  loading={loading}

        toast.error("Athlete context is missing");

        return;        >

      }

          License {athlete.licenseNumber}                  emptyMessage={section.emptyMessage}

      setEditSubmitting(true);

        </span>

      try {

        const payload = {      );      return (                />

          firstName: editForm.firstName.trim() || undefined,

          lastName: editForm.lastName.trim() || undefined,    }

          firstNameAr: editForm.firstNameAr.trim() || undefined,

          lastNameAr: editForm.lastNameAr.trim() || undefined,        <div className="space-y-1 leading-tight">              </div>

          birthDate: editForm.birthDate || undefined,

          gender: editForm.gender || undefined,    if (athlete.cin) {

          cin: editForm.cin.trim() || undefined,

          passportNumber: editForm.passportNumber.trim() || undefined,      badges.push(          <p className="font-semibold text-slate-900">            </section>

        };

        <span

        const currentMembershipClubId =

          editingAthlete.membershipClubId || effectiveClubId || "";          key="cin"            {athlete.fullName || "Unnamed athlete"}          ))}



        if (          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"

          isAdmin &&

          editForm.clubId &&        >          </p>

          editForm.clubId !== currentMembershipClubId

        ) {          CIN {athlete.cin}

          const membershipPayload = {

            clubId: editForm.clubId,        </span>          <p className="text-sm text-slate-500">{athlete.fullNameAr || "—"}</p>          {pendingDeletionRequests.length > 0 && (

          };

      );

          if (currentMembershipClubId) {

            membershipPayload.previousClubId = currentMembershipClubId;    }          {birthDateLabel ? (            <section className="space-y-4">

          }



          payload.membership = membershipPayload;

        }    if (athlete.passportNumber) {            <p className="text-xs text-slate-400">Born {birthDateLabel}</p>              <div className="flex items-center gap-3">



        const response = await fetch(      badges.push(

          `${apiBase}/api/athletes/${editingAthlete._id}`,

          {        <span          ) : null}                <h2 className="text-xl font-semibold text-slate-900">

            method: "PUT",

            headers: {          key="passport"

              "Content-Type": "application/json",

              Authorization: `Bearer ${token}`,          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"        </div>                  Pending Deletion Requests

            },

            body: JSON.stringify(payload),        >

          }

        );          Passport {athlete.passportNumber}      );                </h2>



        const data = await response.json().catch(() => ({}));        </span>



        if (!response.ok) {      );    },                <span className="inline-flex items-center rounded-full bg-amber-500 px-3 py-1 text-xs font-semibold text-white">

          throw new Error(data.message || "Failed to update athlete");

        }    }



        toast.success("Athlete updated");    [formatDisplayDate]                  {pendingDeletionRequests.length}

        closeEditDialog();

        await loadClubDetails();    if (!badges.length) {

      } catch (error) {

        console.error("Failed to update athlete", error);      badges.push(  );                </span>

        toast.error(error.message);

      } finally {        <span key="empty" className="text-sm text-slate-400">

        setEditSubmitting(false);

      }          No identifiers              </div>

    },

    [        </span>

      closeEditDialog,

      editForm,      );  const renderIdentifierBadges = useCallback((athlete) => {              <div className="divide-y divide-amber-100 rounded-3xl border border-amber-200 bg-amber-50 shadow-sm">

      editingAthlete,

      effectiveClubId,    }

      isAdmin,

      loadClubDetails,    const badges = [];                {pendingDeletionRequests.map((request) => {

      token,

    ]    return <div className="flex flex-wrap gap-2">{badges}</div>;

  );

  }, []);                  const requestDate = formatDisplayDate(request.createdAt);

  const handleStatusChange = useCallback(

    async (athleteId, newStatus) => {

      if (!club?._id) {

        toast.error("Club context missing");  const renderStatusBadge = useCallback(    if (athlete.licenseNumber) {                  const requesterName = request.requestedBy

        return;

      }    (athlete) => {



      setStatusUpdating(true);      const normalizedStatus = (      badges.push(                    ? `${request.requestedBy.firstName ?? ""} ${



      try {        athlete.membershipStatus || "inactive"

        const response = await fetch(

          `${apiBase}/api/clubs/${club._id}/athletes/${athleteId}/status`,      ).toLowerCase();        <span                        request.requestedBy.lastName ?? ""

          {

            method: "PATCH",      const badgeClasses =

            headers: {

              "Content-Type": "application/json",        statusBadgeStyles[normalizedStatus] || statusBadgeStyles.default;          key="license"                      }`.trim()

              Authorization: `Bearer ${token}`,

            },      const displayLabel = normalizedStatus

            body: JSON.stringify({ status: newStatus }),

          }        .split(/[\s_-]+/)          className="inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-xs font-medium text-white"                    : "Unknown";

        );

        .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))

        const data = await response.json().catch(() => ({}));

        .join(" ");        >

        if (!response.ok) {

          throw new Error(data.message || "Failed to update athlete status");

        }

      const seasonLabel = athlete.membershipSeason          License {athlete.licenseNumber}                  return (

        toast.success("Athlete status updated");

        await loadClubDetails();        ? `Season ${athlete.membershipSeason}`

      } catch (error) {

        console.error("Failed to update status", error);        : null;        </span>                    <div

        toast.error(error.message);

      } finally {      const memberSince = formatDisplayDate(athlete.membershipStartDate);

        setStatusUpdating(false);

      }      );                      key={request._id}

    },

    [club?._id, loadClubDetails, token]      return (

  );

        <div className="space-y-1">    }                      className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"

  const openTransferDialog = useCallback((athlete) => {

    setTransferDialog({          <span

      isOpen: true,

      athlete,            className={`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ring-1 ring-inset ${badgeClasses}`}                    >

      targetClubId: "",

      note: "",          >

      submitting: false,

    });            {displayLabel}    if (athlete.cin) {                      <div className="space-y-1">

  }, []);

          </span>

  const closeTransferDialog = useCallback(() => {

    setTransferDialog((previous) => ({ ...previous, isOpen: false }));          {seasonLabel ? (      badges.push(                        <p className="font-medium text-slate-900">

  }, []);

            <p className="text-xs text-slate-500">{seasonLabel}</p>

  const handleTransferSubmit = useCallback(

    async (event) => {          ) : null}        <span                          {request.athlete?.firstName} {request.athlete?.lastName} –

      event.preventDefault();

          {memberSince ? (

      if (!transferDialog.athlete || !transferDialog.targetClubId) {

        toast.error("Please select a target club");            <p className="text-xs text-slate-400">Member since {memberSince}</p>          key="cin"                          License {request.athlete?.licenseNumber || "—"}

        return;

      }          ) : null}



      setTransferDialog((previous) => ({ ...previous, submitting: true }));        </div>          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"                        </p>



      try {      );

        const response = await fetch(`${apiBase}/api/athlete-transfers`, {

          method: "POST",    },        >                        <p className="text-sm text-slate-600">

          headers: {

            "Content-Type": "application/json",    [formatDisplayDate]

            Authorization: `Bearer ${token}`,

          },  );          CIN {athlete.cin}                          Requested by {requesterName || "Unknown"}

          body: JSON.stringify({

            athleteId: transferDialog.athlete._id,

            toClubId: transferDialog.targetClubId,

            notes: transferDialog.note || undefined,  const loadClubDetails = useCallback(async () => {        </span>                          {requestDate ? ` on ${requestDate}` : ""}

          }),

        });    if (!token || !detailEndpointId) {



        const data = await response.json().catch(() => ({}));      return;      );                        </p>



        if (!response.ok) {    }

          throw new Error(data.message || "Failed to submit transfer request");

        }    }                        {request.reason ? (



        toast.success("Transfer request submitted");    setLoading(true);

        setTransferDialog({

          isOpen: false,                          <p className="text-sm text-slate-600">

          athlete: null,

          targetClubId: "",    try {

          note: "",

          submitting: false,      const response = await fetch(    if (athlete.passportNumber) {                            Reason: {request.reason}

        });

        await loadClubDetails();        `${apiBase}/api/clubs/${detailEndpointId}/details`,

      } catch (error) {

        console.error("Failed to create transfer request", error);        {      badges.push(                          </p>

        toast.error(error.message);

        setTransferDialog((previous) => ({ ...previous, submitting: false }));          headers: {

      }

    },            Authorization: `Bearer ${token}`,        <span                        ) : null}

    [loadClubDetails, token, transferDialog]

  );          },



  const handleTransferDecision = useCallback(        }          key="passport"                      </div>

    async (requestId, action) => {

      const confirmed = window.confirm(      );

        `Are you sure you want to ${action} this transfer request?`

      );          className="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-medium text-slate-700 ring-1 ring-inset ring-slate-200"                      {permissions.canApproveDeletions ? (



      if (!confirmed) {      if (!response.ok) {

        return;

      }        const data = await response.json().catch(() => ({}));        >                        <div className="flex gap-2">



      try {        throw new Error(data.message || "Failed to load club details");

        const response = await fetch(

          `${apiBase}/api/athlete-transfers/${requestId}`,      }          Passport {athlete.passportNumber}                          <Button

          {

            method: "PATCH",

            headers: {

              "Content-Type": "application/json",      const data = await response.json();        </span>                            size="sm"

              Authorization: `Bearer ${token}`,

            },

            body: JSON.stringify({ action }),

          }      setClub(data.club || null);      );                            variant="outline"

        );

      setAthletes(data.athletes || defaultAthleteBuckets);

        const data = await response.json().catch(() => ({}));

      setCounts({ ...defaultCounts, ...(data.counts || {}) });    }                            onClick={() =>

        if (!response.ok) {

          throw new Error(data.message || "Failed to update transfer request");      setPermissions((previous) => ({

        }

        ...previous,                              handleDeletionDecision(request._id, "reject")

        toast.success(

          action === "approve"        ...(data.permissions || {}),

            ? "Transfer approved"

            : "Transfer request rejected"      }));    if (!badges.length) {                            }

        );

        await loadClubDetails();      setPendingTransfers(

      } catch (error) {

        console.error("Failed to update transfer", error);        Array.isArray(data.pendingTransfers) ? data.pendingTransfers : []      badges.push(                          >

        toast.error(error.message);

      }      );

    },

    [loadClubDetails, token]      setPendingDeletionRequests(        <span key="empty" className="text-sm text-slate-400">                            Reject

  );

        Array.isArray(data.pendingDeletionRequests)

  const openDeleteDialog = useCallback((athlete) => {

    setDeleteDialog({          ? data.pendingDeletionRequests          No identifiers                          </Button>

      isOpen: true,

      athlete,          : []

      reason: "",

      submitting: false,      );        </span>                          <Button

    });

  }, []);    } catch (error) {



  const closeDeleteDialog = useCallback(() => {      console.error("Failed to load club details", error);      );                            size="sm"

    setDeleteDialog((previous) => ({ ...previous, isOpen: false }));

  }, []);      toast.error(error.message);



  const handleDeleteRequestSubmit = useCallback(    } finally {    }                            variant="destructive"

    async (event) => {

      event.preventDefault();      setLoading(false);



      if (!deleteDialog.athlete) {    }                            onClick={() =>

        toast.error("Athlete information is missing");

        return;  }, [detailEndpointId, token]);

      }

    return <div className="flex flex-wrap gap-2">{badges}</div>;                              handleDeletionDecision(request._id, "approve")

      setDeleteDialog((previous) => ({ ...previous, submitting: true }));

  useEffect(() => {

      try {

        const response = await fetch(`${apiBase}/api/athlete-deletions`, {    loadClubDetails();  }, []);                            }

          method: "POST",

          headers: {  }, [loadClubDetails]);

            "Content-Type": "application/json",

            Authorization: `Bearer ${token}`,                          >

          },

          body: JSON.stringify({  const loadClubs = useCallback(async () => {

            athleteId: deleteDialog.athlete._id,

            reason: deleteDialog.reason || undefined,    if (!token || !permissions.canManageAthletes) {  const renderStatusBadge = useCallback(                            Approve & Delete

          }),

        });      return;



        const data = await response.json().catch(() => ({}));    }    (athlete) => {                          </Button>



        if (!response.ok) {

          throw new Error(

            data.message || "Failed to submit athlete deletion request"    try {      const normalizedStatus = (                        </div>

          );

        }      const response = await fetch(`${apiBase}/api/clubs?isActive=true`, {



        toast.success("Deletion request sent to administrator");        headers: {        athlete.membershipStatus || "inactive"                      ) : (

        setDeleteDialog({

          isOpen: false,          Authorization: `Bearer ${token}`,

          athlete: null,

          reason: "",        },      ).toLowerCase();                        <span className="text-sm text-slate-600">

          submitting: false,

        });      });

        await loadClubDetails();

      } catch (error) {      const badgeClasses =                          Awaiting administrator confirmation

        console.error("Failed to submit deletion request", error);

        toast.error(error.message);      if (!response.ok) {

        setDeleteDialog((previous) => ({ ...previous, submitting: false }));

      }        const data = await response.json().catch(() => ({}));        statusBadgeStyles[normalizedStatus] || statusBadgeStyles.default;                        </span>

    },

    [deleteDialog, loadClubDetails, token]        throw new Error(data.message || "Failed to load clubs");

  );

      }      const displayLabel = normalizedStatus                      )}

  const handleAdminDelete = useCallback(

    async (athlete) => {

      const confirmed = window.confirm(

        `Delete ${athlete.fullName || "this athlete"}? This action cannot be undone.`      const data = await response.json();        .split(/[\s_-]+/)                    </div>

      );

      setClubs(Array.isArray(data) ? data : []);

      if (!confirmed) {

        return;    } catch (error) {        .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))                  );

      }

      console.error("Failed to retrieve clubs", error);

      try {

        const response = await fetch(`${apiBase}/api/athletes/${athlete._id}`, {      toast.error(error.message);        .join(" ");                })}

          method: "DELETE",

          headers: {    }

            Authorization: `Bearer ${token}`,

          },  }, [permissions.canManageAthletes, token]);              </div>

        });



        const data = await response.json().catch(() => ({}));

  useEffect(() => {      const seasonLabel = athlete.membershipSeason            </section>

        if (!response.ok) {

          throw new Error(data.message || "Failed to delete athlete");    loadClubs();

        }

  }, [loadClubs]);        ? `Season ${athlete.membershipSeason}`          )}

        toast.success("Athlete deleted");

        await loadClubDetails();

      } catch (error) {

        console.error("Failed to delete athlete", error);  const filterAthletes = useCallback(        : null;

        toast.error(error.message);

      }    (list) => {

    },

    [loadClubDetails, token]      if (!Array.isArray(list) || !list.length) {      const memberSince = formatDisplayDate(athlete.membershipStartDate);          {permissions.canDecideTransfers && pendingTransfers.length > 0 && (

  );

        return [];

  const handleDeletionDecision = useCallback(

    async (requestId, action) => {      }            <section className="space-y-4">

      const confirmed = window.confirm(

        `Are you sure you want to ${action} this deletion request?`

      );

      if (!searchTerm.trim()) {      return (              <div className="flex items-center gap-3">

      if (!confirmed) {

        return;        return list;

      }

      }        <div className="space-y-1">                <h2 className="text-xl font-semibold text-slate-900">

      try {

        const response = await fetch(

          `${apiBase}/api/athlete-deletions/${requestId}`,

          {      const needle = searchTerm.trim().toLowerCase();          <span                  Pending Transfer Requests

            method: "PATCH",

            headers: {

              "Content-Type": "application/json",

              Authorization: `Bearer ${token}`,      return list.filter((athlete) => {            className={`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ring-1 ring-inset ${badgeClasses}`}                </h2>

            },

            body: JSON.stringify({ action }),        const fields = [

          }

        );          athlete.fullName,          >                <span className="inline-flex items-center rounded-full bg-indigo-500 px-3 py-1 text-xs font-semibold text-white">



        const data = await response.json().catch(() => ({}));          athlete.fullNameAr,



        if (!response.ok) {          athlete.licenseNumber,            {displayLabel}                  {pendingTransfers.length}

          throw new Error(

            data.message || "Failed to update athlete deletion request"          athlete.cin,

          );

        }          athlete.passportNumber,          </span>                </span>



        toast.success(        ];

          action === "approve"

            ? "Athlete deleted after administrator approval"          {seasonLabel ? (              </div>

            : "Deletion request rejected"

        );        return fields.some((value) =>

        await loadClubDetails();

      } catch (error) {          value ? value.toString().toLowerCase().includes(needle) : false            <p className="text-xs text-slate-500">{seasonLabel}</p>              <div className="divide-y divide-indigo-100 rounded-3xl border border-indigo-200 bg-indigo-50 shadow-sm">

        console.error("Failed to update deletion request", error);

        toast.error(error.message);        );

      }

    },      });          ) : null}                {pendingTransfers.map((request) => (

    [loadClubDetails, token]

  );    },



  const renderStatusActions = useCallback(    [searchTerm]          {memberSince ? (                  <div

    (athlete) => {

      if (!permissions.canManageAthletes) {  );

        return null;

      }            <p className="text-xs text-slate-400">Member since {memberSince}</p>                    key={request._id}



      const statusActions = [  const filteredAthletes = useMemo(

        {

          key: "activate",    () => ({          ) : null}                    className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"

          label: "Activate",

          status: "active",      active: filterAthletes(athletes.active),

        },

        {      inactive: filterAthletes(athletes.inactive),        </div>                  >

          key: "deactivate",

          label: "Deactivate",      pending: filterAthletes(athletes.pending),

          status: "inactive",

        },      transferred: filterAthletes(athletes.transferred),      );                    <div className="space-y-1">

        {

          key: "pending",    }),

          label: "Mark Pending",

          status: "pending",    [athletes, filterAthletes]    },                      <p className="font-medium text-slate-900">

        },

      ];  );



      const statusButtons = statusActions    [formatDisplayDate]                        {request.athlete?.firstName} {request.athlete?.lastName} –

        .filter((action) => action.status !== athlete.membershipStatus)

        .map((action) => (  const updateEditFormField = useCallback((field, value) => {

          <Button

            key={action.key}    setEditForm((previous) => ({  );                        License {request.athlete?.licenseNumber || "—"}

            size="sm"

            variant="outline"      ...previous,

            className="min-w-[110px]"

            onClick={() => handleStatusChange(athlete._id, action.status)}      [field]: value,                      </p>

            disabled={statusUpdating}

          >    }));

            {action.label}

          </Button>  }, []);  const loadClubDetails = useCallback(async () => {                      <p className="text-sm text-slate-600">

        ));



      const quickActions = [];

  const openEditDialog = useCallback(    if (!token || !detailEndpointId) {                        From {request.fromClub?.name || "Unknown"} to {""}

      quickActions.push(

        <Button    (athlete) => {

          key="edit"

          size="sm"      if (!athlete) {      return;                        {request.toClub?.name || "Unknown"}

          variant="outline"

          className="min-w-[110px]"        return;

          onClick={() => openEditDialog(athlete)}

          disabled={statusUpdating}      }    }                      </p>

        >

          Edit

        </Button>

      );      let birthDateValue = "";                    </div>



      if (permissions.canManageAthletes) {      if (athlete.birthDate) {

        quickActions.push(

          <Button        const parsed = new Date(athlete.birthDate);    setLoading(true);                    <div className="flex gap-2">

            key="transfer"

            size="sm"        if (!Number.isNaN(parsed.getTime())) {

            variant="secondary"

            className="min-w-[110px]"          birthDateValue = parsed.toISOString().slice(0, 10);                      <Button

            onClick={() => openTransferDialog(athlete)}

            disabled={statusUpdating}        }

          >

            Transfer      }    try {                        size="sm"

          </Button>

        );

      }

      const resolvedClubId =      const response = await fetch(                        variant="outline"

      const isDeletionPending = pendingDeletionRequests.some(

        (request) => request.athlete?._id === athlete._id        athlete.membershipClubId || effectiveClubId || "";

      );

        `${apiBase}/api/clubs/${detailEndpointId}/details`,                        onClick={() =>

      if (permissions.canRequestDeletions) {

        const deletionLabel = permissions.canApproveDeletions      setEditingAthlete(athlete);

          ? "Delete"

          : isDeletionPending      setEditForm({        {                          handleTransferDecision(request._id, "reject")

          ? "Awaiting Approval"

          : "Request Delete";        firstName: athlete.firstName || "",



        quickActions.push(        lastName: athlete.lastName || "",          headers: {                        }

          <Button

            key="delete"        firstNameAr: athlete.firstNameAr || "",

            size="sm"

            variant="destructive"        lastNameAr: athlete.lastNameAr || "",            Authorization: `Bearer ${token}`,                      >

            className="min-w-[130px]"

            onClick={() =>        birthDate: birthDateValue,

              permissions.canApproveDeletions

                ? handleAdminDelete(athlete)        gender: athlete.gender || "",          },                        Reject

                : openDeleteDialog(athlete)

            }        cin: athlete.cin || "",

            disabled={

              statusUpdating || (!permissions.canApproveDeletions && isDeletionPending)        passportNumber: athlete.passportNumber || "",        }                      </Button>

            }

          >        clubId: resolvedClubId,

            {deletionLabel}

          </Button>      });      );                      <Button

        );

      }    },



      if (!statusButtons.length && !quickActions.length) {    [effectiveClubId]                        size="sm"

        return null;

      }  );



      return (      if (!response.ok) {                        onClick={() =>

        <div className="flex flex-wrap items-center gap-2">

          {statusButtons.length ? (  const closeEditDialog = useCallback(() => {

            <div className="flex flex-wrap gap-2 rounded-md border border-slate-200 bg-slate-50 px-2 py-1">

              {statusButtons}    setEditingAthlete(null);        const data = await response.json().catch(() => ({}));                          handleTransferDecision(request._id, "approve")

            </div>

          ) : null}    setEditForm({

          {quickActions}

        </div>      firstName: "",        throw new Error(data.message || "Failed to load club details");                        }

      );

    },      lastName: "",

    [

      handleAdminDelete,      firstNameAr: "",      }                      >

      handleStatusChange,

      openDeleteDialog,      lastNameAr: "",

      openEditDialog,

      openTransferDialog,      birthDate: "",                        Approve

      pendingDeletionRequests,

      permissions.canApproveDeletions,      gender: "",

      permissions.canManageAthletes,

      permissions.canRequestDeletions,      cin: "",      const data = await response.json();                      </Button>

      statusUpdating,

    ]      passportNumber: "",

  );

      clubId: "",                    </div>

  const baseColumns = useMemo(

    () => [    });

      {

        field: "fullName",    setEditSubmitting(false);      setClub(data.club || null);                  </div>

        headerText: "Athlete",

        width: "250",  }, []);

        minWidth: 220,

        template: renderAthleteSummary,      setAthletes(data.athletes || defaultAthleteBuckets);                ))}

        allowSorting: true,

        allowFiltering: true,  const handleEditSubmit = useCallback(

        allowExporting: true,

      },    async (event) => {      setCounts({ ...defaultCounts, ...(data.counts || {}) });              </div>

      {

        field: "licenseNumber",      event.preventDefault();

        headerText: "Identifiers",

        width: "260",      setPermissions((previous) => ({            </section>

        minWidth: 220,

        template: renderIdentifierBadges,      if (!token || !editingAthlete) {

        allowSorting: false,

        allowFiltering: false,        toast.error("Athlete context is missing");        ...previous,          )}

        allowExporting: true,

      },        return;

      {

        field: "membershipStatus",      }        ...(data.permissions || {}),        </div>

        headerText: "Status",

        width: "180",

        minWidth: 160,

        template: renderStatusBadge,      setEditSubmitting(true);      }));      </div>

        allowExporting: true,

      },

      {

        field: "actions",      try {      setPendingTransfers(    );

        headerText: "Actions",

        width: "320",        const payload = {

        minWidth: 240,

        template: renderStatusActions,          firstName: editForm.firstName.trim() || undefined,        Array.isArray(data.pendingTransfers) ? data.pendingTransfers : []

        allowFiltering: false,

        allowSorting: false,          lastName: editForm.lastName.trim() || undefined,

        allowExporting: false,

      },          firstNameAr: editForm.firstNameAr.trim() || undefined,      );        const currentMembershipClubId =

    ],

    [          lastNameAr: editForm.lastNameAr.trim() || undefined,

      renderAthleteSummary,

      renderIdentifierBadges,          birthDate: editForm.birthDate || undefined,      setPendingDeletionRequests(          editingAthlete.membershipClubId ||

      renderStatusBadge,

      renderStatusActions,          gender: editForm.gender || undefined,

    ]

  );          cin: editForm.cin.trim() || undefined,        Array.isArray(data.pendingDeletionRequests)          (club && club._id) ||



  const totalAthletes =          passportNumber: editForm.passportNumber.trim() || undefined,

    counts.active + counts.inactive + counts.pending + counts.transferred;

        };          ? data.pendingDeletionRequests          effectiveClubId ||

  const activeRate = totalAthletes

    ? Math.round((counts.active / totalAthletes) * 100)

    : 0;

        const currentMembershipClubId =          : []          "";

  const typeLabel = club

    ? TYPE_LABELS[club.type] || club.type.replace(/_/g, " ")          editingAthlete.membershipClubId || effectiveClubId || "";

    : "—";

      );

  const parentClubReference = club?.parentClub;

        if (

  const parentClubDisplay = useMemo(() => {

    if (!parentClubReference) {          isAdmin &&    } catch (error) {        if (

      return null;

    }          editForm.clubId &&



    if (typeof parentClubReference === "string") {          editForm.clubId !== currentMembershipClubId      console.error("Failed to load club details", error);          isAdmin &&

      const referenced = clubs.find((entry) => entry._id === parentClubReference);

      return referenced?.name || referenced?.code || parentClubReference;        ) {

    }

          const membershipPayload = {      toast.error(error.message);          editForm.clubId &&

    return (

      parentClubReference.name ||            clubId: editForm.clubId,

      parentClubReference.code ||

      parentClubReference._id ||          };    } finally {          editForm.clubId !== currentMembershipClubId

      null

    );

  }, [clubs, parentClubReference]);

          if (currentMembershipClubId) {      setLoading(false);        ) {

  const parentClubIsActive = useMemo(() => {

    if (!parentClubReference || typeof parentClubReference === "string") {            membershipPayload.previousClubId = currentMembershipClubId;

      return null;

    }          }    }          const membershipPayload = {



    return parentClubReference.isActive;

  }, [parentClubReference]);

          payload.membership = membershipPayload;  }, [detailEndpointId, token]);            clubId: editForm.clubId,

  const clubStatusClasses = club?.isActive

    ? "border-emerald-200 bg-emerald-50 text-emerald-700"        }

    : "border-slate-200 bg-slate-100 text-slate-600";

          };

  const contactName = club?.contacts?.primaryName || "Not specified";

  const contactPhone = club?.contacts?.primaryPhone || "—";        const response = await fetch(



  const seasonActivationSummary = useMemo(() => {          `${apiBase}/api/athletes/${editingAthlete._id}`,  useEffect(() => {

    if (!club?.seasonActivation) {

      return null;          {

    }

            method: "PUT",    loadClubDetails();          if (currentMembershipClubId) {

    const { from, to } = club.seasonActivation;

    const formattedFrom = formatDisplayDate(from);            headers: {

    const formattedTo = formatDisplayDate(to);

              "Content-Type": "application/json",  }, [loadClubDetails]);            membershipPayload.previousClubId = currentMembershipClubId;

    if (!formattedFrom && !formattedTo) {

      return null;              Authorization: `Bearer ${token}`,

    }

            },          }

    if (formattedFrom && formattedTo) {

      return `${formattedFrom} – ${formattedTo}`;            body: JSON.stringify(payload),

    }

          }  const loadClubs = useCallback(async () => {

    if (formattedFrom) {

      return `From ${formattedFrom}`;        );

    }

    if (!token || !permissions.canManageAthletes) {          payload.membership = membershipPayload;

    return `Until ${formattedTo}`;

  }, [club?.seasonActivation, formatDisplayDate]);        const data = await response.json().catch(() => ({}));



  const membershipSummaryCards = useMemo(      return;        }

    () =>

      ATHLETE_STATUS_SUMMARY.map((meta) => {        if (!response.ok) {

        const value = counts[meta.key] ?? 0;

        const percent = totalAthletes          throw new Error(data.message || "Failed to update athlete");    }

          ? Math.round((value / totalAthletes) * 100)

          : 0;        }



        return {        const response = await fetch(

          ...meta,

          count: value,        toast.success("Athlete updated");

          percent,

        };        closeEditDialog();    try {          `${apiBase}/api/athletes/${editingAthlete._id}`,

      }),

    [counts, totalAthletes]        await loadClubDetails();

  );

      } catch (error) {      const response = await fetch(`${apiBase}/api/clubs?isActive=true`, {          {

  const athleteSections = useMemo(

    () =>        console.error("Failed to update athlete", error);

      ATHLETE_STATUS_SUMMARY.map((meta) => ({

        ...meta,        toast.error(error.message);        headers: {            method: "PUT",

        title: meta.label,

        data: filteredAthletes[meta.key] || [],      } finally {

        count: counts[meta.key] ?? 0,

        gridId: `club-${meta.key}-grid`,        setEditSubmitting(false);          Authorization: `Bearer ${token}`,            headers: {

        emptyMessage: ATHLETE_EMPTY_MESSAGES[meta.key],

      })),      }

    [counts, filteredAthletes]

  );    },        },              "Content-Type": "application/json",



  const displayedAthletesCount = useMemo(    [

    () =>

      filteredAthletes.active.length +      closeEditDialog,      });              Authorization: `Bearer ${token}`,

      filteredAthletes.inactive.length +

      filteredAthletes.pending.length +      editForm,

      filteredAthletes.transferred.length,

    [      editingAthlete,            },

      filteredAthletes.active.length,

      filteredAthletes.inactive.length,      effectiveClubId,

      filteredAthletes.pending.length,

      filteredAthletes.transferred.length,      isAdmin,      if (!response.ok) {            body: JSON.stringify(payload),

    ]

  );      loadClubDetails,



  if (!detailEndpointId) {      token,        const data = await response.json().catch(() => ({}));          }

    return (

      <div className="max-w-5xl mx-auto py-14 px-4">    ]

        <p className="text-center text-slate-600">

          Club information is not available for this account.  );        throw new Error(data.message || "Failed to load clubs");        );

        </p>

        <div className="mt-6 text-center">

          <Button onClick={() => navigate(-1)}>Go Back</Button>

        </div>  const handleStatusChange = useCallback(      }

      </div>

    );    async (athleteId, newStatus) => {

  }

      if (!club?._id) {        const data = await response.json().catch(() => ({}));

  if (loading && !club) {

    return (        toast.error("Club context missing");

      <div className="flex min-h-screen items-center justify-center bg-slate-50">

        <div className="space-y-3 text-center">        return;      const data = await response.json();

          <div className="mx-auto h-12 w-12 animate-spin rounded-full border-2 border-slate-200 border-t-slate-500" />

          <p className="text-sm text-slate-500">Loading club details...</p>      }

        </div>

      </div>      setClubs(Array.isArray(data) ? data : []);        if (!response.ok) {

    );

  }      setStatusUpdating(true);



  return (    } catch (error) {          throw new Error(data.message || "Failed to update athlete");

    <div className="min-h-screen bg-slate-50">

      <div className="mx-auto max-w-[1400px] space-y-8 p-6">      try {

        <div className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">

          <div className="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">        const response = await fetch(      console.error("Failed to retrieve clubs", error);        }

            <div className="flex items-start gap-5">

              <ClubLogoPreview          `${apiBase}/api/clubs/${club._id}/athletes/${athleteId}/status`,

                name={club?.name}

                code={club?.code}          {      toast.error(error.message);

                logoUrl={club?.logoUrl}

              />            method: "PATCH",

              <div className="space-y-4">

                <div>            headers: {    }        toast.success("Athlete updated");

                  <h1 className="text-3xl font-semibold text-slate-900">

                    {club?.name || "Club"}              "Content-Type": "application/json",

                  </h1>

                  {club?.nameAr ? (              Authorization: `Bearer ${token}`,  }, [permissions.canManageAthletes, token]);        closeEditDialog();

                    <p className="text-sm text-slate-500">{club.nameAr}</p>

                  ) : null}            },

                </div>

                <div className="flex flex-wrap items-center gap-2">            body: JSON.stringify({ status: newStatus }),        await loadClubDetails();

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">

                    {typeLabel}          }

                  </span>

                  <span        );  useEffect(() => {      } catch (error) {

                    className={`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${clubStatusClasses}`}

                  >

                    {club?.isActive ? "Active" : "Inactive"}

                  </span>        const data = await response.json().catch(() => ({}));    loadClubs();        console.error("Failed to update athlete", error);

                  <span className="inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">

                    {totalAthletes} total athletes

                  </span>

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-600">        if (!response.ok) {  }, [loadClubs]);        toast.error(error.message);

                    {activeRate}% active rate

                  </span>          throw new Error(data.message || "Failed to update athlete status");

                </div>

              </div>        }      } finally {

            </div>

            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">

              <DetailItem label="Club Code">{club?.code}</DetailItem>

              <DetailItem label="Email">        toast.success("Athlete status updated");  const filterAthletes = useCallback(        setEditSubmitting(false);

                {club?.email ? (

                  <a        await loadClubDetails();

                    href={`mailto:${club.email}`}

                    className="text-blue-600 hover:underline"      } catch (error) {    (list) => {      }

                  >

                    {club.email}        console.error("Failed to update status", error);

                  </a>

                ) : null}        toast.error(error.message);      if (!Array.isArray(list) || !list.length) {    },

              </DetailItem>

              <DetailItem label="Phone">{club?.phone}</DetailItem>      } finally {

              <DetailItem label="City">{club?.city}</DetailItem>

              <DetailItem label="Address">        setStatusUpdating(false);        return [];    [

                {club?.address ? (

                  <span className="block break-words">{club.address}</span>      }

                ) : null}

              </DetailItem>    },      }      closeEditDialog,

              <DetailItem label="Parent Club">

                {parentClubDisplay ? (    [club?._id, loadClubDetails, token]

                  <span className="flex flex-wrap items-center gap-2">

                    <span>{parentClubDisplay}</span>  );      club,

                    {parentClubIsActive !== null ? (

                      <span

                        className={`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${

                          parentClubIsActive  const openTransferDialog = useCallback((athlete) => {      if (!searchTerm.trim()) {      editForm,

                            ? "bg-emerald-100 text-emerald-700"

                            : "bg-slate-100 text-slate-600"    setTransferDialog({

                        }`}

                      >      isOpen: true,        return list;      editingAthlete,

                        {parentClubIsActive ? "Active" : "Inactive"}

                      </span>      athlete,

                    ) : null}

                  </span>      targetClubId: "",      }      effectiveClubId,

                ) : (

                  "—"      note: "",

                )}

              </DetailItem>      submitting: false,      isAdmin,

              <DetailItem label="Primary Contact">{contactName}</DetailItem>

              <DetailItem label="Contact Phone">{contactPhone}</DetailItem>    });

              <DetailItem label="Season Activation">

                {seasonActivationSummary || "—"}  }, []);      const needle = searchTerm.trim().toLowerCase();      loadClubDetails,

              </DetailItem>

            </div>

          </div>

          <div className="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">  const closeTransferDialog = useCallback(() => {      token,

            {membershipSummaryCards.map((card) => (

              <div    setTransferDialog((previous) => ({ ...previous, isOpen: false }));

                key={card.key}

                className={`rounded-2xl border ${card.cardClasses} p-5 shadow-sm`}  }, []);      return list.filter((athlete) => {    ]

              >

                <p className="text-sm font-medium text-slate-600">

                  {card.label}

                </p>  const handleTransferSubmit = useCallback(        const fields = [  );

                <div className="mt-3 flex items-end gap-2">

                  <span className="text-3xl font-semibold text-slate-900">    async (event) => {

                    {card.count}

                  </span>      event.preventDefault();          athlete.fullName,

                  <span className="text-xs text-slate-500">

                    {card.percent}% of roster

                  </span>

                </div>      if (!transferDialog.athlete || !transferDialog.targetClubId) {          athlete.fullNameAr,  const handleStatusChange = useCallback(

                <div className="mt-4 h-2 rounded-full bg-white/70">

                  <div        toast.error("Please select a target club");

                    className={`h-full rounded-full ${card.badgeClasses}`}

                    style={{ width: `${card.percent}%` }}        return;          athlete.licenseNumber,    async (athleteId, newStatus) => {

                  />

                </div>      }

              </div>

            ))}          athlete.cin,      if (!club?._id) {

          </div>

          <div className="mt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">      setTransferDialog((previous) => ({ ...previous, submitting: true }));

            <p className="text-sm text-slate-500">

              Displaying {displayedAthletesCount} of {totalAthletes} athletes          athlete.passportNumber,        toast.error("Club context missing");

              across all statuses.

            </p>      try {

            <div className="flex flex-col gap-3 sm:flex-row sm:items-center">

              <Input        const response = await fetch(`${apiBase}/api/athlete-transfers`, {        ];        return;

                placeholder="Search athletes by name, license, CIN..."

                value={searchTerm}          method: "POST",

                onChange={(event) => setSearchTerm(event.target.value)}

                className="w-full sm:w-72"          headers: {      }

              />

              <Button            "Content-Type": "application/json",

                variant="outline"

                onClick={() => loadClubDetails()}            Authorization: `Bearer ${token}`,        return fields.some((value) =>

                disabled={loading}

              >          },

                Refresh

              </Button>          body: JSON.stringify({          value ? value.toString().toLowerCase().includes(needle) : false      setStatusUpdating(true);

            </div>

          </div>            athleteId: transferDialog.athlete._id,

        </div>

            toClubId: transferDialog.targetClubId,        );

        {athleteSections.map((section) => (

          <section key={section.key} className="space-y-4">            notes: transferDialog.note || undefined,

            <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">

              <div className="flex items shoulder`... (truncated)          }),      });      try {

        });

    },        const response = await fetch(

        const data = await response.json().catch(() => ({}));

    [searchTerm]          `${apiBase}/api/clubs/${club._id}/athletes/${athleteId}/status`,

        if (!response.ok) {

          throw new Error(data.message || "Failed to submit transfer request");  );          {

        }

            method: "PATCH",

        toast.success("Transfer request submitted");

        setTransferDialog({  const filteredAthletes = useMemo(            headers: {

          isOpen: false,

          athlete: null,    () => ({              "Content-Type": "application/json",

          targetClubId: "",

          note: "",      active: filterAthletes(athletes.active),              Authorization: `Bearer ${token}`,

          submitting: false,

        });      inactive: filterAthletes(athletes.inactive),            },

        await loadClubDetails();

      } catch (error) {      pending: filterAthletes(athletes.pending),            body: JSON.stringify({ status: newStatus }),

        console.error("Failed to create transfer request", error);

        toast.error(error.message);      transferred: filterAthletes(athletes.transferred),          }

        setTransferDialog((previous) => ({ ...previous, submitting: false }));

      }    }),        );

    },

    [loadClubDetails, token, transferDialog]    [athletes, filterAthletes]

  );

  );        const data = await response.json().catch(() => ({}));

  const handleTransferDecision = useCallback(

    async (requestId, action) => {

      const confirmed = window.confirm(

        `Are you sure you want to ${action} this transfer request?`  const updateEditFormField = useCallback((field, value) => {        if (!response.ok) {

      );

    setEditForm((previous) => ({          throw new Error(data.message || "Failed to update athlete status");

      if (!confirmed) {

        return;      ...previous,        }

      }

      [field]: value,

      try {

        const response = await fetch(    }));        toast.success("Athlete status updated");

          `${apiBase}/api/athlete-transfers/${requestId}`,

          {  }, []);        await loadClubDetails();

            method: "PATCH",

            headers: {      } catch (error) {

              "Content-Type": "application/json",

              Authorization: `Bearer ${token}`,  const openEditDialog = useCallback(        console.error("Failed to update status", error);

            },

            body: JSON.stringify({ action }),    (athlete) => {        toast.error(error.message);

          }

        );      if (!athlete) {      } finally {



        const data = await response.json().catch(() => ({}));        return;        setStatusUpdating(false);



        if (!response.ok) {      }      }

          throw new Error(data.message || "Failed to update transfer request");

        }    },



        toast.success(      let birthDateValue = "";    [club?._id, loadClubDetails, token]

          action === "approve"

            ? "Transfer approved"      if (athlete.birthDate) {  );

            : "Transfer request rejected"

        );        const parsed = new Date(athlete.birthDate);

        await loadClubDetails();

      } catch (error) {        if (!Number.isNaN(parsed.getTime())) {  const openTransferDialog = useCallback((athlete) => {

        console.error("Failed to update transfer", error);

        toast.error(error.message);          birthDateValue = parsed.toISOString().slice(0, 10);    setTransferDialog({

      }

    },        }      isOpen: true,

    [loadClubDetails, token]

  );      }      athlete,



  const openDeleteDialog = useCallback((athlete) => {      targetClubId: "",

    setDeleteDialog({

      isOpen: true,      const resolvedClubId =      note: "",

      athlete,

      reason: "",        athlete.membershipClubId || effectiveClubId || "";      submitting: false,

      submitting: false,

    });    });

  }, []);

      setEditingAthlete(athlete);  }, []);

  const closeDeleteDialog = useCallback(() => {

    setDeleteDialog((previous) => ({ ...previous, isOpen: false }));      setEditForm({

  }, []);

        firstName: athlete.firstName || "",  const closeTransferDialog = useCallback(() => {

  const handleDeleteRequestSubmit = useCallback(

    async (event) => {        lastName: athlete.lastName || "",    setTransferDialog((prev) => ({ ...prev, isOpen: false }));

      event.preventDefault();

        firstNameAr: athlete.firstNameAr || "",  }, []);

      if (!deleteDialog.athlete) {

        toast.error("Athlete information is missing");        lastNameAr: athlete.lastNameAr || "",

        return;

      }        birthDate: birthDateValue,  const handleTransferSubmit = async (event) => {



      setDeleteDialog((previous) => ({ ...previous, submitting: true }));        gender: athlete.gender || "",    event.preventDefault();



      try {        cin: athlete.cin || "",

        const response = await fetch(`${apiBase}/api/athlete-deletions`, {

          method: "POST",        passportNumber: athlete.passportNumber || "",    if (!transferDialog.athlete || !transferDialog.targetClubId) {

          headers: {

            "Content-Type": "application/json",        clubId: resolvedClubId,      toast.error("Please select a target club");

            Authorization: `Bearer ${token}`,

          },      });      return;

          body: JSON.stringify({

            athleteId: deleteDialog.athlete._id,    },    }

            reason: deleteDialog.reason || undefined,

          }),    [effectiveClubId]

        });

  );    setTransferDialog((prev) => ({ ...prev, submitting: true }));

        const data = await response.json().catch(() => ({}));



        if (!response.ok) {

          throw new Error(  const closeEditDialog = useCallback(() => {    try {

            data.message || "Failed to submit athlete deletion request"

          );    setEditingAthlete(null);      const response = await fetch(`${apiBase}/api/athlete-transfers`, {

        }

    setEditForm({        method: "POST",

        toast.success("Deletion request sent to administrator");

        setDeleteDialog({      firstName: "",        headers: {

          isOpen: false,

          athlete: null,      lastName: "",          "Content-Type": "application/json",

          reason: "",

          submitting: false,      firstNameAr: "",          Authorization: `Bearer ${token}`,

        });

        await loadClubDetails();      lastNameAr: "",        },

      } catch (error) {

        console.error("Failed to submit deletion request", error);      birthDate: "",        body: JSON.stringify({

        toast.error(error.message);

        setDeleteDialog((previous) => ({ ...previous, submitting: false }));      gender: "",          athleteId: transferDialog.athlete._id,

      }

    },      cin: "",          toClubId: transferDialog.targetClubId,

    [deleteDialog, loadClubDetails, token]

  );      passportNumber: "",          notes: transferDialog.note || undefined,



  const handleAdminDelete = useCallback(      clubId: "",        }),

    async (athlete) => {

      const confirmed = window.confirm(    });      });

        `Delete ${athlete.fullName || "this athlete"}? This action cannot be undone.`

      );    setEditSubmitting(false);



      if (!confirmed) {  }, []);      const data = await response.json().catch(() => ({}));

        return;

      }



      try {  const handleEditSubmit = useCallback(      if (!response.ok) {

        const response = await fetch(`${apiBase}/api/athletes/${athlete._id}`, {

          method: "DELETE",    async (event) => {        throw new Error(data.message || "Failed to submit transfer request");

          headers: {

            Authorization: `Bearer ${token}`,      event.preventDefault();      }

          },

        });



        const data = await response.json().catch(() => ({}));      if (!token || !editingAthlete) {      toast.success("Transfer request submitted");



        if (!response.ok) {        toast.error("Athlete context is missing");      setTransferDialog({

          throw new Error(data.message || "Failed to delete athlete");

        }        return;        isOpen: false,



        toast.success("Athlete deleted");      }        athlete: null,

        await loadClubDetails();

      } catch (error) {        targetClubId: "",

        console.error("Failed to delete athlete", error);

        toast.error(error.message);      setEditSubmitting(true);        note: "",

      }

    },        submitting: false,

    [loadClubDetails, token]

  );      try {      });



  const handleDeletionDecision = useCallback(        const payload = {      await loadClubDetails();

    async (requestId, action) => {

      const confirmed = window.confirm(          firstName: editForm.firstName.trim() || undefined,    } catch (error) {

        `Are you sure you want to ${action} this deletion request?`

      );          lastName: editForm.lastName.trim() || undefined,      console.error("Failed to create transfer request", error);



      if (!confirmed) {          firstNameAr: editForm.firstNameAr.trim() || undefined,      toast.error(error.message);

        return;

      }          lastNameAr: editForm.lastNameAr.trim() || undefined,      setTransferDialog((prev) => ({ ...prev, submitting: false }));



      try {          birthDate: editForm.birthDate || undefined,    }

        const response = await fetch(

          `${apiBase}/api/athlete-deletions/${requestId}`,          gender: editForm.gender || undefined,  };

          {

            method: "PATCH",          cin: editForm.cin.trim() || undefined,

            headers: {

              "Content-Type": "application/json",          passportNumber: editForm.passportNumber.trim() || undefined,  const handleTransferDecision = useCallback(

              Authorization: `Bearer ${token}`,

            },        };    async (requestId, action) => {

            body: JSON.stringify({ action }),

          }      const confirmed = window.confirm(

        );

        const currentMembershipClubId =        `Are you sure you want to ${action} this transfer request?`

        const data = await response.json().catch(() => ({}));

          editingAthlete.membershipClubId || effectiveClubId || "";      );

        if (!response.ok) {

          throw new Error(

            data.message || "Failed to update athlete deletion request"

          );        if (      if (!confirmed) {

        }

          isAdmin &&        return;

        toast.success(

          action === "approve"          editForm.clubId &&      }

            ? "Athlete deleted after administrator approval"

            : "Deletion request rejected"          editForm.clubId !== currentMembershipClubId

        );

        await loadClubDetails();        ) {      try {

      } catch (error) {

        console.error("Failed to update deletion request", error);          const membershipPayload = {        const response = await fetch(

        toast.error(error.message);

      }            clubId: editForm.clubId,          `${apiBase}/api/athlete-transfers/${requestId}`,

    },

    [loadClubDetails, token]          };          {

  );

            method: "PATCH",

  const renderStatusActions = useCallback(

    (athlete) => {          if (currentMembershipClubId) {            headers: {

      if (!permissions.canManageAthletes) {

        return null;            membershipPayload.previousClubId = currentMembershipClubId;              "Content-Type": "application/json",

      }

          }              Authorization: `Bearer ${token}`,

      const statusActions = [

        {            },

          key: "activate",

          label: "Activate",          payload.membership = membershipPayload;            body: JSON.stringify({ action }),

          status: "active",

        },        }          }

        {

          key: "deactivate",        );

          label: "Deactivate",

          status: "inactive",        const response = await fetch(

        },

        {          `${apiBase}/api/athletes/${editingAthlete._id}`,        const data = await response.json().catch(() => ({}));

          key: "pending",

          label: "Mark Pending",          {

          status: "pending",

        },            method: "PUT",        if (!response.ok) {

      ];

            headers: {          throw new Error(data.message || "Failed to update transfer request");

      const statusButtons = statusActions

        .filter((action) => action.status !== athlete.membershipStatus)              "Content-Type": "application/json",        }

        .map((action) => (

          <Button              Authorization: `Bearer ${token}`,

            key={action.key}

            size="sm"            },        toast.success(

            variant="outline"

            className="min-w-[110px]"            body: JSON.stringify(payload),          action === "approve"

            onClick={() => handleStatusChange(athlete._id, action.status)}

            disabled={statusUpdating}          }            ? "Transfer approved"

          >

            {action.label}        );            : "Transfer request rejected"

          </Button>

        ));        );



      const quickActions = [];        const data = await response.json().catch(() => ({}));        await loadClubDetails();



      quickActions.push(      } catch (error) {

        <Button

          key="edit"        if (!response.ok) {        console.error("Failed to update transfer", error);

          size="sm"

          variant="outline"          throw new Error(data.message || "Failed to update athlete");        toast.error(error.message);

          className="min-w-[110px]"

          onClick={() => openEditDialog(athlete)}        }      }

          disabled={statusUpdating}

        >    },

          Edit

        </Button>        toast.success("Athlete updated");    [loadClubDetails, token]

      );

        closeEditDialog();  );

      if (permissions.canManageAthletes) {

        quickActions.push(        await loadClubDetails();

          <Button

            key="transfer"      } catch (error) {  const openDeleteDialog = useCallback((athlete) => {

            size="sm"

            variant="secondary"        console.error("Failed to update athlete", error);    setDeleteDialog({

            className="min-w-[110px]"

            onClick={() => openTransferDialog(athlete)}        toast.error(error.message);      isOpen: true,

            disabled={statusUpdating}

          >      } finally {      athlete,

            Transfer

          </Button>        setEditSubmitting(false);      reason: "",

        );

      }      }      submitting: false,



      const isDeletionPending = pendingDeletionRequests.some(    },    });

        (request) => request.athlete?._id === athlete._id

      );    [  }, []);



      if (permissions.canRequestDeletions) {      closeEditDialog,

        const deletionLabel = permissions.canApproveDeletions

          ? "Delete"      editForm,  const closeDeleteDialog = useCallback(() => {

          : isDeletionPending

          ? "Awaiting Approval"      editingAthlete,    setDeleteDialog((prev) => ({ ...prev, isOpen: false }));

          : "Request Delete";

      effectiveClubId,  }, []);

        quickActions.push(

          <Button      isAdmin,

            key="delete"

            size="sm"      loadClubDetails,  const handleDeleteRequestSubmit = async (event) => {

            variant="destructive"

            className="min-w-[130px]"      token,    event.preventDefault();

            onClick={() =>

              permissions.canApproveDeletions    ]

                ? handleAdminDelete(athlete)

                : openDeleteDialog(athlete)  );    if (!deleteDialog.athlete) {

            }

            disabled={      toast.error("Athlete information is missing");

              statusUpdating || (!permissions.canApproveDeletions && isDeletionPending)

            }  const handleStatusChange = useCallback(      return;

          >

            {deletionLabel}    async (athleteId, newStatus) => {    }

          </Button>

        );      if (!club?._id) {

      }

        toast.error("Club context missing");    setDeleteDialog((prev) => ({ ...prev, submitting: true }));

      if (!statusButtons.length && !quickActions.length) {

        return null;        return;

      }

      }    try {

      return (

        <div className="flex flex-wrap items-center gap-2">      const response = await fetch(`${apiBase}/api/athlete-deletions`, {

          {statusButtons.length ? (

            <div className="flex flex-wrap gap-2 rounded-md border border-slate-200 bg-slate-50 px-2 py-1">      setStatusUpdating(true);        method: "POST",

              {statusButtons}

            </div>        headers: {

          ) : null}

          {quickActions}      try {          "Content-Type": "application/json",

        </div>

      );        const response = await fetch(          Authorization: `Bearer ${token}`,

    },

    [          `${apiBase}/api/clubs/${club._id}/athletes/${athleteId}/status`,        },

      handleAdminDelete,

      handleStatusChange,          {        body: JSON.stringify({

      openDeleteDialog,

      openEditDialog,            method: "PATCH",          athleteId: deleteDialog.athlete._id,

      openTransferDialog,

      pendingDeletionRequests,            headers: {          reason: deleteDialog.reason || undefined,

      permissions.canApproveDeletions,

      permissions.canManageAthletes,              "Content-Type": "application/json",        }),

      permissions.canRequestDeletions,

      statusUpdating,              Authorization: `Bearer ${token}`,      });

    ]

  );            },



  const baseColumns = useMemo(            body: JSON.stringify({ status: newStatus }),      const data = await response.json().catch(() => ({}));

    () => [

      {          }

        field: "fullName",

        headerText: "Athlete",        );      if (!response.ok) {

        width: "250",

        minWidth: 220,        throw new Error(

        template: renderAthleteSummary,

        allowSorting: true,        const data = await response.json().catch(() => ({}));          data.message || "Failed to submit athlete deletion request"

        allowFiltering: true,

        allowExporting: true,        );

      },

      {        if (!response.ok) {      }

        field: "licenseNumber",

        headerText: "Identifiers",          throw new Error(data.message || "Failed to update athlete status");

        width: "260",

        minWidth: 220,        }      toast.success("Deletion request sent to administrator");

        template: renderIdentifierBadges,

        allowSorting: false,      setDeleteDialog({

        allowFiltering: false,

        allowExporting: true,        toast.success("Athlete status updated");        isOpen: false,

      },

      {        await loadClubDetails();        athlete: null,

        field: "membershipStatus",

        headerText: "Status",      } catch (error) {        reason: "",

        width: "180",

        minWidth: 160,        console.error("Failed to update status", error);        submitting: false,

        template: renderStatusBadge,

        allowExporting: true,        toast.error(error.message);      });

      },

      {      } finally {      await loadClubDetails();

        field: "actions",

        headerText: "Actions",        setStatusUpdating(false);    } catch (error) {

        width: "320",

        minWidth: 240,      }      console.error("Failed to submit deletion request", error);

        template: renderStatusActions,

        allowFiltering: false,    },      toast.error(error.message);

        allowSorting: false,

        allowExporting: false,    [club?._id, loadClubDetails, token]      setDeleteDialog((prev) => ({ ...prev, submitting: false }));

      },

    ],  );    }

    [

      renderAthleteSummary,  };

      renderIdentifierBadges,

      renderStatusBadge,  const openTransferDialog = useCallback((athlete) => {

      renderStatusActions,

    ]    setTransferDialog({  const handleAdminDelete = useCallback(

  );

      isOpen: true,    async (athlete) => {

  const totalAthletes =

    counts.active + counts.inactive + counts.pending + counts.transferred;      athlete,      const confirmed = window.confirm(



  const activeRate = totalAthletes      targetClubId: "",        `Delete ${

    ? Math.round((counts.active / totalAthletes) * 100)

    : 0;      note: "",          athlete.fullName || "this athlete"



  const typeLabel = club      submitting: false,        }? This action cannot be undone.`

    ? TYPE_LABELS[club.type] || club.type.replace(/_/g, " ")

    : "—";    });      );



  const parentClubReference = club?.parentClub;  }, []);



  const parentClubDisplay = useMemo(() => {      if (!confirmed) {

    if (!parentClubReference) {

      return null;  const closeTransferDialog = useCallback(() => {        return;

    }

    setTransferDialog((previous) => ({ ...previous, isOpen: false }));      }

    if (typeof parentClubReference === "string") {

      const referenced = clubs.find((entry) => entry._id === parentClubReference);  }, []);

      return referenced?.name || referenced?.code || parentClubReference;

    }      try {



    return (  const handleTransferSubmit = useCallback(        const response = await fetch(`${apiBase}/api/athletes/${athlete._id}`, {

      parentClubReference.name ||

      parentClubReference.code ||    async (event) => {          method: "DELETE",

      parentClubReference._id ||

      null      event.preventDefault();          headers: {

    );

  }, [clubs, parentClubReference]);            Authorization: `Bearer ${token}`,



  const parentClubIsActive = useMemo(() => {      if (!transferDialog.athlete || !transferDialog.targetClubId) {          },

    if (!parentClubReference || typeof parentClubReference === "string") {

      return null;        toast.error("Please select a target club");        });

    }

        return;

    return parentClubReference.isActive;

  }, [parentClubReference]);      }        const data = await response.json().catch(() => ({}));



  const clubStatusClasses = club?.isActive

    ? "border-emerald-200 bg-emerald-50 text-emerald-700"

    : "border-slate-200 bg-slate-100 text-slate-600";      setTransferDialog((previous) => ({ ...previous, submitting: true }));        if (!response.ok) {



  const contactName = club?.contacts?.primaryName || "Not specified";          throw new Error(data.message || "Failed to delete athlete");

  const contactPhone = club?.contacts?.primaryPhone || "—";

      try {        }

  const seasonActivationSummary = useMemo(() => {

    if (!club?.seasonActivation) {        const response = await fetch(`${apiBase}/api/athlete-transfers`, {

      return null;

    }          method: "POST",        toast.success("Athlete deleted");



    const { from, to } = club.seasonActivation;          headers: {        await loadClubDetails();

    const formattedFrom = formatDisplayDate(from);

    const formattedTo = formatDisplayDate(to);            "Content-Type": "application/json",      } catch (error) {



    if (!formattedFrom && !formattedTo) {            Authorization: `Bearer ${token}`,        console.error("Failed to delete athlete", error);

      return null;

    }          },        toast.error(error.message);



    if (formattedFrom && formattedTo) {          body: JSON.stringify({      }

      return `${formattedFrom} – ${formattedTo}`;

    }            athleteId: transferDialog.athlete._id,    },



    if (formattedFrom) {            toClubId: transferDialog.targetClubId,    [loadClubDetails, token]

      return `From ${formattedFrom}`;

    }            notes: transferDialog.note || undefined,  );



    return `Until ${formattedTo}`;          }),

  }, [club?.seasonActivation, formatDisplayDate]);

        });  const handleDeletionDecision = useCallback(

  const membershipSummaryCards = useMemo(

    () =>    async (requestId, action) => {

      ATHLETE_STATUS_SUMMARY.map((meta) => {

        const value = counts[meta.key] ?? 0;        const data = await response.json().catch(() => ({}));      const confirmed = window.confirm(

        const percent = totalAthletes

          ? Math.round((value / totalAthletes) * 100)        `Are you sure you want to ${action} this deletion request?`

          : 0;

        if (!response.ok) {      );

        return {

          ...meta,          throw new Error(data.message || "Failed to submit transfer request");

          count: value,

          percent,        }      if (!confirmed) {

        };

      }),        return;

    [counts, totalAthletes]

  );        toast.success("Transfer request submitted");      }



  const athleteSections = useMemo(        setTransferDialog({

    () =>

      ATHLETE_STATUS_SUMMARY.map((meta) => ({          isOpen: false,      try {

        ...meta,

        title: meta.label,          athlete: null,        const response = await fetch(

        data: filteredAthletes[meta.key] || [],

        count: counts[meta.key] ?? 0,          targetClubId: "",          `${apiBase}/api/athlete-deletions/${requestId}`,

        gridId: `club-${meta.key}-grid`,

        emptyMessage: ATHLETE_EMPTY_MESSAGES[meta.key],          note: "",          {

      })),

    [counts, filteredAthletes]          submitting: false,            method: "PATCH",

  );

        });            headers: {

  const displayedAthletesCount = useMemo(

    () =>        await loadClubDetails();              "Content-Type": "application/json",

      filteredAthletes.active.length +

      filteredAthletes.inactive.length +      } catch (error) {              Authorization: `Bearer ${token}`,

      filteredAthletes.pending.length +

      filteredAthletes.transferred.length,        console.error("Failed to create transfer request", error);            },

    [

      filteredAthletes.active.length,        toast.error(error.message);            body: JSON.stringify({ action }),

      filteredAthletes.inactive.length,

      filteredAthletes.pending.length,        setTransferDialog((previous) => ({ ...previous, submitting: false }));          }

      filteredAthletes.transferred.length,

    ]      }        );

  );

    },

  if (!detailEndpointId) {

    return (    [loadClubDetails, token, transferDialog]        const data = await response.json().catch(() => ({}));

      <div className="max-w-5xl mx-auto py-14 px-4">

        <p className="text-center text-slate-600">  );

          Club information is not available for this account.

        </p>        if (!response.ok) {

        <div className="mt-6 text-center">

          <Button onClick={() => navigate(-1)}>Go Back</Button>  const handleTransferDecision = useCallback(          throw new Error(

        </div>

      </div>    async (requestId, action) => {            data.message || "Failed to update athlete deletion request"

    );

  }      const confirmed = window.confirm(          );



  if (loading && !club) {        `Are you sure you want to ${action} this transfer request?`        }

    return (

      <div className="flex min-h-screen items-center justify-center bg-slate-50">      );

        <div className="space-y-3 text-center">

          <div className="mx-auto h-12 w-12 animate-spin rounded-full border-2 border-slate-200 border-t-slate-500" />        toast.success(

          <p className="text-sm text-slate-500">Loading club details...</p>

        </div>      if (!confirmed) {          action === "approve"

      </div>

    );        return;            ? "Athlete deleted after administrator approval"

  }

      }            : "Deletion request rejected"

  return (

    <div className="min-h-screen bg-slate-50">        );

      <div className="mx-auto max-w-[1400px] space-y-8 p-6">

        <div className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">      try {        await loadClubDetails();

          <div className="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">

            <div className="flex items-start gap-5">        const response = await fetch(      } catch (error) {

              <ClubLogoPreview

                name={club?.name}          `${apiBase}/api/athlete-transfers/${requestId}`,        console.error("Failed to update deletion request", error);

                code={club?.code}

                logoUrl={club?.logoUrl}          {        toast.error(error.message);

              />

              <div className="space-y-4">            method: "PATCH",      }

                <div>

                  <h1 className="text-3xl font-semibold text-slate-900">            headers: {    },

                    {club?.name || "Club"}

                  </h1>              "Content-Type": "application/json",    [loadClubDetails, token]

                  {club?.nameAr ? (

                    <p className="text-sm text-slate-500">{club.nameAr}</p>              Authorization: `Bearer ${token}`,  );

                  ) : null}

                </div>            },

                <div className="flex flex-wrap items-center gap-2">

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">            body: JSON.stringify({ action }),  const renderStatusActions = useCallback(

                    {typeLabel}

                  </span>          }    (athlete) => {

                  <span

                    className={`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${clubStatusClasses}`}        );      if (!permissions.canManageAthletes) {

                  >

                    {club?.isActive ? "Active" : "Inactive"}        return null;

                  </span>

                  <span className="inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">        const data = await response.json().catch(() => ({}));      }

                    {totalAthletes} total athletes

                  </span>

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-600">

                    {activeRate}% active rate        if (!response.ok) {      const statusActions = [

                  </span>

                </div>          throw new Error(data.message || "Failed to update transfer request");        {

              </div>

            </div>        }          key: "activate",

            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">

              <DetailItem label="Club Code">{club?.code}</DetailItem>          label: "Activate",

              <DetailItem label="Email">

                {club?.email ? (        toast.success(          status: "active",

                  <a

                    href={`mailto:${club.email}`}          action === "approve"        },

                    className="text-blue-600 hover:underline"

                  >            ? "Transfer approved"        {

                    {club.email}

                  </a>            : "Transfer request rejected"          key: "deactivate",

                ) : null}

              </DetailItem>        );          label: "Deactivate",

              <DetailItem label="Phone">{club?.phone}</DetailItem>

              <DetailItem label="City">{club?.city}</DetailItem>        await loadClubDetails();          status: "inactive",

              <DetailItem label="Address">

                {club?.address ? (      } catch (error) {        },

                  <span className="block break-words">{club.address}</span>

                ) : null}        console.error("Failed to update transfer", error);        {

              </DetailItem>

              <DetailItem label="Parent Club">        toast.error(error.message);          key: "pending",

                {parentClubDisplay ? (

                  <span className="flex flex-wrap items-center gap-2">      }          label: "Mark Pending",

                    <span>{parentClubDisplay}</span>

                    {parentClubIsActive !== null ? (    },          status: "pending",

                      <span

                        className={`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${    [loadClubDetails, token]        },

                          parentClubIsActive

                            ? "bg-emerald-100 text-emerald-700"  );      ];

                            : "bg-slate-100 text-slate-600"

                        }`}

                      >

                        {parentClubIsActive ? "Active" : "Inactive"}  const openDeleteDialog = useCallback((athlete) => {      const statusButtons = statusActions

                      </span>

                    ) : null}    setDeleteDialog({        .filter((action) => action.status !== athlete.membershipStatus)

                  </span>

                ) : (      isOpen: true,        .map((action) => (

                  "—"

                )}      athlete,          <Button

              </DetailItem>

              <DetailItem label="Primary Contact">{contactName}</DetailItem>      reason: "",            key={action.key}

              <DetailItem label="Contact Phone">{contactPhone}</DetailItem>

              <DetailItem label="Season Activation">      submitting: false,            size="sm"

                {seasonActivationSummary || "—"}

              </DetailItem>    });            variant="outline"

            </div>

          </div>  }, []);            className="min-w-[110px]"

          <div className="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">

            {membershipSummaryCards.map((card) => (            onClick={() => handleStatusChange(athlete._id, action.status)}

              <div

                key={card.key}  const closeDeleteDialog = useCallback(() => {            disabled={statusUpdating}

                className={`rounded-2xl border ${card.cardClasses} p-5 shadow-sm`}

              >    setDeleteDialog((previous) => ({ ...previous, isOpen: false }));          >

                <p className="text-sm font-medium text-slate-600">

                  {card.label}  }, []);            {action.label}

                </p>

                <div className="mt-3 flex items-end gap-2">          </Button>

                  <span className="text-3xl font-semibold text-slate-900">

                    {card.count}  const handleDeleteRequestSubmit = useCallback(        ));

                  </span>

                  <span className="text-xs text-slate-500">    async (event) => {

                    {card.percent}% of roster

                  </span>      event.preventDefault();      const quickActions = [];

                </div>

                <div className="mt-4 h-2 rounded-full bg-white/70">

                  <div

                    className={`h-full rounded-full ${card.badgeClasses}`}      if (!deleteDialog.athlete) {      quickActions.push(

                    style={{ width: `${card.percent}%` }}

                  />        toast.error("Athlete information is missing");        <Button

                </div>

              </div>        return;          key="edit"

            ))}

          </div>      }          size="sm"

          <div className="mt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">

            <p className="text-sm text-slate-500">          variant="outline"

              Displaying {displayedAthletesCount} of {totalAthletes} athletes

              across all statuses.      setDeleteDialog((previous) => ({ ...previous, submitting: true }));          className="min-w-[110px]"

            </p>

            <div className="flex flex-col gap-3 sm:flex-row sm:items-center">          onClick={() => openEditDialog(athlete)}

              <Input

                placeholder="Search athletes by name, license, CIN..."      try {          disabled={statusUpdating}

                value={searchTerm}

                onChange={(event) => setSearchTerm(event.target.value)}        const response = await fetch(`${apiBase}/api/athlete-deletions`, {        >

                className="w-full sm:w-72"

              />          method: "POST",          Edit

              <Button

                variant="outline"          headers: {        </Button>

                onClick={() => loadClubDetails()}

                disabled={loading}            "Content-Type": "application/json",      );

              >

                Refresh            Authorization: `Bearer ${token}`,      const isDeletionPending = pendingDeletionRequests.some(

              </Button>

            </div>          },        (request) => request.athlete?._id === athlete._id

          </div>

        </div>          body: JSON.stringify({      );



        {athleteSections.map((section) => (            athleteId: deleteDialog.athlete._id,

          <section key={section.key} className="space-y-4">

            <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">            reason: deleteDialog.reason || undefined,      if (permissions.canManageAthletes) {

              <div className="flex items-center gap-3">

                <h2 className="text-xl font-semibold text-slate-900">          }),        quickActions.push(

                  {section.title}

                </h2>        });          <Button

                <span

                  className={`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold text-white ${section.badgeClasses}`}            key="transfer"

                >

                  {section.count} total        const data = await response.json().catch(() => ({}));            size="sm"

                </span>

              </div>            variant="secondary"

              <span className="text-sm text-slate-500">

                {section.data.length} shown        if (!response.ok) {            className="min-w-[110px]"

              </span>

            </div>          throw new Error(            onClick={() => openTransferDialog(athlete)}

            <div className="rounded-3xl border border-slate-200 bg-white p-3 shadow-sm">

              <DataGrid            data.message || "Failed to submit athlete deletion request"            disabled={statusUpdating}

                data={section.data}

                columns={baseColumns}          );          >

                gridId={section.gridId}

                loading={loading}        }            Transfer

                emptyMessage={section.emptyMessage}

              />          </Button>

            </div>

          </section>        toast.success("Deletion request sent to administrator");        );

        ))}

        setDeleteDialog({      }

        {pendingDeletionRequests.length > 0 && (

          <section className="space-y-4">          isOpen: false,

            <div className="flex items-center gap-3">

              <h2 className="text-xl font-semibold text-slate-900">          athlete: null,      if (permissions.canRequestDeletions) {

                Pending Deletion Requests

              </h2>          reason: "",        const isAdmin = permissions.canApproveDeletions;

              <span className="inline-flex items-center rounded-full bg-amber-500 px-3 py-1 text-xs font-semibold text-white">

                {pendingDeletionRequests.length}          submitting: false,        const label = isAdmin

              </span>

            </div>        });          ? "Delete"

            <div className="divide-y divide-amber-100 rounded-3xl border border-amber-200 bg-amber-50 shadow-sm">

              {pendingDeletionRequests.map((request) => {        await loadClubDetails();          : isDeletionPending

                const requestDate = formatDisplayDate(request.createdAt);

                const requesterName = request.requestedBy      } catch (error) {          ? "Awaiting Approval"

                  ? `${request.requestedBy.firstName ?? ""} ${

                      request.requestedBy.lastName ?? ""        console.error("Failed to submit deletion request", error);          : "Request Delete";

                    }`.trim()

                  : "Unknown";        toast.error(error.message);        quickActions.push(



                return (        setDeleteDialog((previous) => ({ ...previous, submitting: false }));          <Button

                  <div

                    key={request._id}      }            key="delete"

                    className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"

                  >    },            size="sm"

                    <div className="space-y-1">

                      <p className="font-medium text-slate-900">    [deleteDialog, loadClubDetails, token]            variant="destructive"

                        {request.athlete?.firstName} {request.athlete?.lastName} – License {" "}

                        {request.athlete?.licenseNumber || "—"}  );            className="min-w-[130px]"

                      </p>

                      <p className="text-sm text-slate-600">            onClick={() =>

                        Requested by {requesterName || "Unknown"}

                        {requestDate ? ` on ${requestDate}` : ""}  const handleAdminDelete = useCallback(              isAdmin ? handleAdminDelete(athlete) : openDeleteDialog(athlete)

                      </p>

                      {request.reason ? (    async (athlete) => {            }

                        <p className="text-sm text-slate-600">

                          Reason: {request.reason}      const confirmed = window.confirm(            disabled={statusUpdating || (!isAdmin && isDeletionPending)}

                        </p>

                      ) : null}        `Delete ${athlete.fullName || "this athlete"}? This action cannot be undone.`          >

                    </div>

                    {permissions.canApproveDeletions ? (      );            {label}

                      <div className="flex gap-2">

                        <Button          </Button>

                          size="sm"

                          variant="outline"      if (!confirmed) {        );

                          onClick={() =>

                            handleDeletionDecision(request._id, "reject")        return;      }

                          }

                        >      }

                          Reject

                        </Button>      if (!statusButtons.length && !quickActions.length) {

                        <Button

                          size="sm"      try {        return null;

                          variant="destructive"

                          onClick={() =>        const response = await fetch(`${apiBase}/api/athletes/${athlete._id}`, {      }

                            handleDeletionDecision(request._id, "approve")

                          }          method: "DELETE",

                        >

                          Approve & Delete          headers: {      return (

                        </Button>

                      </div>            Authorization: `Bearer ${token}`,        <div className="flex flex-wrap items-center gap-2">

                    ) : (

                      <span className="text-sm text-slate-600">          },          {statusButtons.length ? (

                        Awaiting administrator confirmation

                      </span>        });            <div className="flex flex-wrap gap-2 rounded-md border border-gray-200 bg-gray-50 px-2 py-1">

                    )}

                  </div>              {statusButtons}

                );

              })}        const data = await response.json().catch(() => ({}));            </div>

            </div>

          </section>          ) : null}

        )}

        if (!response.ok) {          {quickActions}

        {permissions.canDecideTransfers && pendingTransfers.length > 0 && (

          <section className="space-y-4">          throw new Error(data.message || "Failed to delete athlete");        </div>

            <div className="flex items-center gap-3">

              <h2 className="text-xl font-semibold text-slate-900">        }      );

                Pending Transfer Requests

              </h2>    },

              <span className="inline-flex items-center rounded-full bg-indigo-500 px-3 py-1 text-xs font-semibold text-white">

                {pendingTransfers.length}        toast.success("Athlete deleted");    [

              </span>

            </div>        await loadClubDetails();      handleAdminDelete,

            <div className="divide-y divide-indigo-100 rounded-3xl border border-indigo-200 bg-indigo-50 shadow-sm">

              {pendingTransfers.map((request) => (      } catch (error) {      handleStatusChange,

                <div

                  key={request._id}        console.error("Failed to delete athlete", error);      openDeleteDialog,

                  className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"

                >        toast.error(error.message);      openEditDialog,

                  <div className="space-y-1">

                    <p className="font-medium text-slate-900">      }      openTransferDialog,

                      {request.athlete?.firstName} {request.athlete?.lastName} – License {" "}

                      {request.athlete?.licenseNumber || "—"}    },      pendingDeletionRequests,

                    </p>

                    <p className="text-sm text-slate-600">    [loadClubDetails, token]      permissions.canApproveDeletions,

                      From {request.fromClub?.name || "Unknown"} to{" "}

                      {request.toClub?.name || "Unknown"}  );      permissions.canManageAthletes,

                    </p>

                  </div>      permissions.canRequestDeletions,

                  <div className="flex gap-2">

                    <Button  const handleDeletionDecision = useCallback(      statusUpdating,

                      size="sm"

                      variant="outline"    async (requestId, action) => {    ]

                      onClick={() =>

                        handleTransferDecision(request._id, "reject")      const confirmed = window.confirm(  );

                      }

                    >        `Are you sure you want to ${action} this deletion request?`

                      Reject

                    </Button>      );  const baseColumns = useMemo(

                    <Button

                      size="sm"    () => [

                      onClick={() =>

                        handleTransferDecision(request._id, "approve")      if (!confirmed) {      {

                      }

                    >        return;        field: "fullName",

                      Approve

                    </Button>      }        headerText: "Athlete",

                  </div>

                </div>        width: "250",

              ))}

            </div>      try {        minWidth: 220,

          </section>

        )}        const response = await fetch(        template: renderAthleteSummary,

      </div>

          `${apiBase}/api/athlete-deletions/${requestId}`,        allowSorting: true,

      {transferDialog.isOpen ? (

        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">          {        allowFiltering: true,

          <div className="w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl">

            <div className="mb-4 flex items-center justify-between">            method: "PATCH",        allowExporting: true,

              <h2 className="text-lg font-semibold text-slate-900">

                Transfer Athlete            headers: {      },

              </h2>

              <button              "Content-Type": "application/json",      {

                type="button"

                onClick={closeTransferDialog}              Authorization: `Bearer ${token}`,        field: "licenseNumber",

                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"

                aria-label="Close"            },        headerText: "Identifiers",

              >

                ×            body: JSON.stringify({ action }),        width: "260",

              </button>

            </div>          }        minWidth: 220,

            <form onSubmit={handleTransferSubmit} className="space-y-4">

              <div>        );        template: renderIdentifierBadges,

                <Label>Athlete</Label>

                <p className="text-sm text-slate-700">        allowSorting: false,

                  {transferDialog.athlete?.fullName || "Unnamed athlete"}

                </p>        const data = await response.json().catch(() => ({}));        allowFiltering: false,

              </div>

              <div className="space-y-2">        allowExporting: true,

                <Label htmlFor="transfer-target">Target Club</Label>

                <Select        if (!response.ok) {      },

                  id="transfer-target"

                  value={transferDialog.targetClubId}          throw new Error(      {

                  onChange={(event) =>

                    setTransferDialog((previous) => ({            data.message || "Failed to update athlete deletion request"        field: "membershipStatus",

                      ...previous,

                      targetClubId: event.target.value,          );        headerText: "Status",

                    }))

                  }        }        width: "180",

                  required

                >        minWidth: 160,

                  <option value="">Select club</option>

                  {clubs        toast.success(        template: renderStatusBadge,

                    .filter((entry) => entry._id !== club?._id)

                    .map((entry) => (          action === "approve"        allowExporting: true,

                      <option key={entry._id} value={entry._id}>

                        {entry.name}            ? "Athlete deleted after administrator approval"      },

                      </option>

                    ))}            : "Deletion request rejected"      {

                </Select>

              </div>        );        field: "actions",

              <div className="space-y-2">

                <Label htmlFor="transfer-note">Notes</Label>        await loadClubDetails();        headerText: "Actions",

                <textarea

                  id="transfer-note"      } catch (error) {        width: "320",

                  rows={3}

                  className="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40"        console.error("Failed to update deletion request", error);        minWidth: 240,

                  value={transferDialog.note}

                  onChange={(event) =>        toast.error(error.message);        template: renderStatusActions,

                    setTransferDialog((previous) => ({

                      ...previous,      }        allowFiltering: false,

                      note: event.target.value,

                    }))    },        allowSorting: false,

                  }

                  placeholder="Optional context for the receiving club"    [loadClubDetails, token]        allowExporting: false,

                />

              </div>  );      },

              <div className="flex justify-end gap-2">

                <Button type="button" variant="outline" onClick={closeTransferDialog}>    ],

                  Cancel

                </Button>  const renderStatusActions = useCallback(    [

                <Button type="submit" disabled={transferDialog.submitting}>

                  {transferDialog.submitting ? "Submitting..." : "Submit Transfer"}    (athlete) => {      renderAthleteSummary,

                </Button>

              </div>      if (!permissions.canManageAthletes) {      renderIdentifierBadges,

            </form>

          </div>        return null;      renderStatusBadge,

        </div>

      ) : null}      }      renderStatusActions,



      {deleteDialog.isOpen ? (    ]

        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">

          <div className="w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl">      const statusActions = [  );

            <div className="mb-4 flex items-center justify-between">

              <h2 className="text-lg font-semibold text-slate-900">        {

                Request Athlete Deletion

              </h2>          key: "activate",  const totalAthletes =

              <button

                type="button"          label: "Activate",    counts.active + counts.inactive + counts.pending + counts.transferred;

                onClick={closeDeleteDialog}

                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"          status: "active",

                aria-label="Close"

              >        },  const activeRate = totalAthletes

                ×

              </button>        {    ? Math.round((counts.active / totalAthletes) * 100)

            </div>

            <form onSubmit={handleDeleteRequestSubmit} className="space-y-4">          key: "deactivate",    : 0;

              <div>

                <Label>Athlete</Label>          label: "Deactivate",

                <p className="text-sm text-slate-700">

                  {deleteDialog.athlete?.fullName || "Unnamed athlete"}          status: "inactive",  const typeLabel = club

                </p>

              </div>        },    ? TYPE_LABELS[club.type] || club.type.replace(/_/g, " ")

              <div className="space-y-2">

                <Label htmlFor="delete-reason">Reason</Label>        {    : "—";

                <textarea

                  id="delete-reason"          key: "pending",

                  rows={4}

                  className="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40"          label: "Mark Pending",  const parentClubDisplay = useMemo(() => {

                  value={deleteDialog.reason}

                  onChange={(event) =>          status: "pending",    const reference = club?.parentClub;

                    setDeleteDialog((previous) => ({

                      ...previous,        },

                      reason: event.target.value,

                    }))      ];    if (!reference) {

                  }

                  placeholder="Provide context for the administrator (optional)"      return null;

                />

              </div>      const statusButtons = statusActions    }

              <div className="flex justify-end gap-2">

                <Button type="button" variant="outline" onClick={closeDeleteDialog}>        .filter((action) => action.status !== athlete.membershipStatus)

                  Cancel

                </Button>        .map((action) => (    if (typeof reference === "string") {

                <Button type="submit" disabled={deleteDialog.submitting}>

                  {deleteDialog.submitting ? "Submitting..." : "Submit Request"}          <Button      return reference;

                </Button>

              </div>            key={action.key}    }

            </form>

          </div>            size="sm"

        </div>

      ) : null}            variant="outline"    return reference.name || reference.code || reference._id || null;



      {editingAthlete ? (            className="min-w-[110px]"  }, [club]);

        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">

          <div className="w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl">            onClick={() => handleStatusChange(athlete._id, action.status)}

            <div className="mb-4 flex items-center justify-between">

              <h2 className="text-lg font-semibold text-slate-900">            disabled={statusUpdating}  const parentClubIsActive = useMemo(() => {

                Edit Athlete

              </h2>          >    const reference = club?.parentClub;

              <button

                type="button"            {action.label}

                onClick={closeEditDialog}

                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"          </Button>    if (!reference || typeof reference === "string") {

                aria-label="Close"

              >        ));      return null;

                ×

              </button>    }

            </div>

            <form onSubmit={handleEditSubmit} className="space-y-5">      const quickActions = [];

              <div className="grid gap-4 sm:grid-cols-2">

                <div className="space-y-2">    return reference.isActive;

                  <Label htmlFor="edit-first-name">First Name</Label>

                  <Input      quickActions.push(  }, [club]);

                    id="edit-first-name"

                    value={editForm.firstName}        <Button

                    onChange={(event) =>

                      updateEditFormField("firstName", event.target.value)          key="edit"  const clubStatusClasses = club?.isActive

                    }

                  />          size="sm"    ? "border-emerald-200 bg-emerald-50 text-emerald-700"

                </div>

                <div className="space-y-2">          variant="outline"    : "border-slate-200 bg-slate-100 text-slate-600";

                  <Label htmlFor="edit-last-name">Last Name</Label>

                  <Input          className="min-w-[110px]"

                    id="edit-last-name"

                    value={editForm.lastName}          onClick={() => openEditDialog(athlete)}  const contactName = club?.contacts?.primaryName || "Not specified";

                    onChange={(event) =>

                      updateEditFormField("lastName", event.target.value)          disabled={statusUpdating}  const contactPhone = club?.contacts?.primaryPhone || "—";

                    }

                  />        >

                </div>

                <div className="space-y-2">          Edit  const seasonActivationSummary = useMemo(() => {

                  <Label htmlFor="edit-first-name-ar">First Name (Arabic)</Label>

                  <Input        </Button>    if (!club?.seasonActivation) {

                    id="edit-first-name-ar"

                    value={editForm.firstNameAr}      );      return null;

                    onChange={(event) =>

                      updateEditFormField("firstNameAr", event.target.value)    }

                    }

                  />      if (permissions.canManageAthletes) {

                </div>

                <div className="space-y-2">        quickActions.push(    const { from, to } = club.seasonActivation;

                  <Label htmlFor="edit-last-name-ar">Last Name (Arabic)</Label>

                  <Input          <Button    const formattedFrom = formatDisplayDate(from);

                    id="edit-last-name-ar"

                    value={editForm.lastNameAr}            key="transfer"    const formattedTo = formatDisplayDate(to);

                    onChange={(event) =>

                      updateEditFormField("lastNameAr", event.target.value)            size="sm"

                    }

                  />            variant="secondary"    if (!formattedFrom && !formattedTo) {

                </div>

                <div className="space-y-2">            className="min-w-[110px]"      return null;

                  <Label htmlFor="edit-birthdate">Birth Date</Label>

                  <Input            onClick={() => openTransferDialog(athlete)}    }

                    id="edit-birthdate"

                    type="date"            disabled={statusUpdating}

                    value={editForm.birthDate}

                    onChange={(event) =>          >    if (formattedFrom && formattedTo) {

                      updateEditFormField("birthDate", event.target.value)

                    }            Transfer      return `${formattedFrom} – ${formattedTo}`;

                  />

                </div>          </Button>    }

                <div className="space-y-2">

                  <Label htmlFor="edit-gender">Gender</Label>        );

                  <Select

                    id="edit-gender"      }    if (formattedFrom) {

                    value={editForm.gender}

                    onChange={(event) =>      return `From ${formattedFrom}`;

                      updateEditFormField("gender", event.target.value)

                    }      const isDeletionPending = pendingDeletionRequests.some(    }

                  >

                    <option value="">Select gender</option>        (request) => request.athlete?._id === athlete._id

                    <option value="homme">Male</option>

                    <option value="femme">Female</option>      );    return `Until ${formattedTo}`;

                  </Select>

                </div>  }, [club?.seasonActivation, formatDisplayDate]);

                <div className="space-y-2">

                  <Label htmlFor="edit-cin">CIN</Label>      if (permissions.canRequestDeletions) {

                  <Input

                    id="edit-cin"        const deletionLabel = permissions.canApproveDeletions  const membershipSummaryCards = useMemo(

                    value={editForm.cin}

                    onChange={(event) =>          ? "Delete"    () =>

                      updateEditFormField("cin", event.target.value)

                    }          : isDeletionPending      ATHLETE_STATUS_SUMMARY.map((meta) => {

                  />

                </div>          ? "Awaiting Approval"        const value = counts[meta.key] ?? 0;

                <div className="space-y-2">

                  <Label htmlFor="edit-passport">Passport Number</Label>          : "Request Delete";        const percent = totalAthletes

                  <Input

                    id="edit-passport"          ? Math.round((value / totalAthletes) * 100)

                    value={editForm.passportNumber}

                    onChange={(event) =>        quickActions.push(          : 0;

                      updateEditFormField("passportNumber", event.target.value)

                    }          <Button

                  />

                </div>            key="delete"        return {

                {isAdmin ? (

                  <div className="space-y-2 sm:col-span-2">            size="sm"          ...meta,

                    <Label htmlFor="edit-club">Club Assignment</Label>

                    <Select            variant="destructive"          count: value,

                      id="edit-club"

                      value={editForm.clubId}            className="min-w-[130px]"          percent,

                      onChange={(event) =>

                        updateEditFormField("clubId", event.target.value)            onClick={() =>        };

                      }

                    >              permissions.canApproveDeletions      }),

                      <option value="">Keep current club</option>

                      {clubs.map((entry) => (                ? handleAdminDelete(athlete)    [counts, totalAthletes]

                        <option key={entry._id} value={entry._id}>

                          {entry.name}                : openDeleteDialog(athlete)  );

                        </option>

                      ))}            }

                    </Select>

                    <p className="text-xs text-slate-500">            disabled={  const athleteSections = useMemo(

                      Administrators can move the athlete to another club while updating profile details.

                    </p>              statusUpdating || (!permissions.canApproveDeletions && isDeletionPending)    () =>

                  </div>

                ) : null}            }      ATHLETE_STATUS_SUMMARY.map((meta) => ({

              </div>

          >        ...meta,

              <div className="flex justify-end gap-2">

                <Button type="button" variant="outline" onClick={closeEditDialog}>            {deletionLabel}        title: meta.label,

                  Cancel

                </Button>          </Button>        data: filteredAthletes[meta.key] || [],

                <Button type="submit" disabled={editSubmitting}>

                  {editSubmitting ? "Saving..." : "Save Changes"}        );        count: counts[meta.key] ?? 0,

                </Button>

              </div>      }        gridId: `club-${meta.key}-grid`,

            </form>

          </div>        emptyMessage: ATHLETE_EMPTY_MESSAGES[meta.key],

        </div>

      ) : null}      if (!statusButtons.length && !quickActions.length) {        alwaysShow: true,

    </div>

  );        return null;      })),

};

      }    [counts, filteredAthletes]

export default ClubDetail;

  );

      return (

        <div className="flex flex-wrap items-center gap-2">  const displayedAthletesCount =

          {statusButtons.length ? (    filteredAthletes.active.length +

            <div className="flex flex-wrap gap-2 rounded-md border border-slate-200 bg-slate-50 px-2 py-1">    filteredAthletes.inactive.length +

              {statusButtons}    filteredAthletes.pending.length +

            </div>    filteredAthletes.transferred.length;

          ) : null}

          {quickActions}  if (!detailEndpointId) {

        </div>    return (

      );      <div className="max-w-5xl mx-auto py-14 px-4">

    },        <p className="text-center text-gray-600">

    [          Club information is not available for this account.

      handleAdminDelete,        </p>

      handleStatusChange,        <div className="mt-6 text-center">

      openDeleteDialog,          <Button onClick={() => navigate(-1)}>Go Back</Button>

      openEditDialog,        </div>

      openTransferDialog,      </div>

      pendingDeletionRequests,    );

      permissions.canApproveDeletions,  }

      permissions.canManageAthletes,

      permissions.canRequestDeletions,  return (

      statusUpdating,    <div className="max-w-6xl mx-auto py-8 px-4 space-y-8">

    ]      <header className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">

  );        <div>

          <h1 className="text-3xl font-semibold text-gray-900">

  const baseColumns = useMemo(            {club?.name || "Club"}

    () => [          </h1>

      {          <p className="text-gray-500">

        field: "fullName",            Code: <span className="font-medium">{club?.code || "—"}</span>

        headerText: "Athlete",          </p>

        width: "250",        </div>

        minWidth: 220,        <div className="flex items-center gap-3">

        template: renderAthleteSummary,          <Input

        allowSorting: true,            placeholder="Search athletes..."

        allowFiltering: true,            value={searchTerm}

        allowExporting: true,            onChange={(event) => setSearchTerm(event.target.value)}

      },            className="w-64"

      {          />

        field: "licenseNumber",          <Button variant="outline" onClick={() => loadClubDetails()}>

        headerText: "Identifiers",            Refresh

        width: "260",          </Button>

        minWidth: 220,        </div>

        template: renderIdentifierBadges,      </header>

        allowSorting: false,

        allowFiltering: false,      <section className="grid grid-cols-1 md:grid-cols-4 gap-4">

        allowExporting: true,        <div className="bg-white shadow rounded-lg p-4">

      },          <p className="text-sm text-gray-500">Active Athletes</p>

      {          <p className="text-2xl font-semibold text-gray-900">

        field: "membershipStatus",            {counts.active}

        headerText: "Status",          </p>

        width: "180",        </div>

        minWidth: 160,        <div className="bg-white shadow rounded-lg p-4">

        template: renderStatusBadge,          <p className="text-sm text-gray-500">Inactive Athletes</p>

        allowExporting: true,          <p className="text-2xl font-semibold text-gray-900">

      },            {counts.inactive}

      {          </p>

        field: "actions",        </div>

        headerText: "Actions",        <div className="bg-white shadow rounded-lg p-4">

        width: "320",          <p className="text-sm text-gray-500">Pending Athletes</p>

        minWidth: 240,          <p className="text-2xl font-semibold text-gray-900">

        template: renderStatusActions,            {counts.pending}

        allowFiltering: false,          </p>

        allowSorting: false,        </div>

        allowExporting: false,        <div className="bg-white shadow rounded-lg p-4">

      },          <p className="text-sm text-gray-500">Transferred</p>

    ],          <p className="text-2xl font-semibold text-gray-900">

    [            {counts.transferred}

      renderAthleteSummary,          </p>

      renderIdentifierBadges,        </div>

      renderStatusBadge,      </section>

      renderStatusActions,

    ]      <section className="space-y-4">

  );        <div className="flex items-center justify-between">

          <h2 className="text-xl font-semibold text-gray-800">

  const totalAthletes =            Active Athletes

    counts.active + counts.inactive + counts.pending + counts.transferred;          </h2>

          <span className="text-sm text-gray-500">

  const activeRate = totalAthletes            {filteredAthletes.active.length} shown

    ? Math.round((counts.active / totalAthletes) * 100)          </span>

    : 0;        </div>

        <div className="bg-white rounded-lg shadow p-2">

  const typeLabel = club          <DataGrid

    ? TYPE_LABELS[club.type] || club.type.replace(/_/g, " ")            data={filteredAthletes.active}

    : "—";            columns={baseColumns}

            gridId="club-active-grid"

  const parentClubReference = club?.parentClub;            loading={loading}

            emptyMessage="No active athletes found"

  const parentClubDisplay = useMemo(() => {          />

    if (!parentClubReference) {        </div>

      return null;      </section>

    }

      <section className="space-y-4">

    if (typeof parentClubReference === "string") {        <div className="flex items-center justify-between">

      const referenced = clubs.find((entry) => entry._id === parentClubReference);          <h2 className="text-xl font-semibold text-gray-800">

      return referenced?.name || referenced?.code || parentClubReference;            Inactive Athletes

    }          </h2>

          <span className="text-sm text-gray-500">

    return (            {filteredAthletes.inactive.length} shown

      parentClubReference.name ||          </span>

      parentClubReference.code ||        </div>

      parentClubReference._id ||        <div className="bg-white rounded-lg shadow p-2">

      null          <DataGrid

    );            data={filteredAthletes.inactive}

  }, [clubs, parentClubReference]);            columns={baseColumns}

            gridId="club-inactive-grid"

  const parentClubIsActive = useMemo(() => {            loading={loading}

    if (!parentClubReference || typeof parentClubReference === "string") {            emptyMessage="No inactive athletes"

      return null;          />

    }        </div>

      </section>

    return parentClubReference.isActive;

  }, [parentClubReference]);      {filteredAthletes.pending.length > 0 && (

        <section className="space-y-4">

  const clubStatusClasses = club?.isActive          <div className="flex items-center justify-between">

    ? "border-emerald-200 bg-emerald-50 text-emerald-700"            <h2 className="text-xl font-semibold text-gray-800">

    : "border-slate-200 bg-slate-100 text-slate-600";              Pending Athletes

            </h2>

  const contactName = club?.contacts?.primaryName || "Not specified";            <span className="text-sm text-gray-500">

  const contactPhone = club?.contacts?.primaryPhone || "—";              {filteredAthletes.pending.length} shown

            </span>

  const seasonActivationSummary = useMemo(() => {          </div>

    if (!club?.seasonActivation) {          <div className="bg-white rounded-lg shadow p-2">

      return null;            <DataGrid

    }              data={filteredAthletes.pending}

              columns={baseColumns}

    const { from, to } = club.seasonActivation;              gridId="club-pending-grid"

    const formattedFrom = formatDisplayDate(from);              loading={loading}

    const formattedTo = formatDisplayDate(to);              emptyMessage="No pending athletes"

            />

    if (!formattedFrom && !formattedTo) {          </div>

      return null;        </section>

    }      )}



    if (formattedFrom && formattedTo) {      <section className="space-y-4">

      return `${formattedFrom} – ${formattedTo}`;        <div className="flex items-center justify-between">

    }          <h2 className="text-xl font-semibold text-gray-800">

            Transferred Athletes

    if (formattedFrom) {          </h2>

      return `From ${formattedFrom}`;          <span className="text-sm text-gray-500">

    }            {filteredAthletes.transferred.length} shown

          </span>

    return `Until ${formattedTo}`;        </div>

  }, [club?.seasonActivation, formatDisplayDate]);        <div className="bg-white rounded-lg shadow p-2">

          <DataGrid

  const membershipSummaryCards = useMemo(            data={filteredAthletes.transferred}

    () =>            columns={baseColumns}

      ATHLETE_STATUS_SUMMARY.map((meta) => {            gridId="club-transferred-grid"

        const value = counts[meta.key] ?? 0;            loading={loading}

        const percent = totalAthletes            emptyMessage="No transferred athletes"

          ? Math.round((value / totalAthletes) * 100)          />

          : 0;        </div>

      </section>

        return {

          ...meta,      {pendingDeletionRequests.length > 0 && (

          count: value,        <section className="space-y-4">

          percent,          <h2 className="text-xl font-semibold text-gray-800">

        };            Pending Deletion Requests

      }),          </h2>

    [counts, totalAthletes]          <div className="bg-white rounded-lg shadow divide-y">

  );            {pendingDeletionRequests.map((request) => {

              const requestDate = formatDisplayDate(request.createdAt);

  const athleteSections = useMemo(              const requesterName = request.requestedBy

    () =>                ? `${request.requestedBy.firstName ?? ""} ${

      ATHLETE_STATUS_SUMMARY.map((meta) => ({                    request.requestedBy.lastName ?? ""

        ...meta,                  }`.trim()

        title: meta.label,                : "Unknown";

        data: filteredAthletes[meta.key] || [],

        count: counts[meta.key] ?? 0,              return (

        gridId: `club-${meta.key}-grid`,                <div

        emptyMessage: ATHLETE_EMPTY_MESSAGES[meta.key],                  key={request._id}

      })),                  className="p-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between"

    [counts, filteredAthletes]                >

  );                  <div className="space-y-1">

                    <p className="font-medium text-gray-900">

  const displayedAthletesCount = useMemo(                      {request.athlete?.firstName} {request.athlete?.lastName} –

    () =>                      License {request.athlete?.licenseNumber || "—"}

      filteredAthletes.active.length +                    </p>

      filteredAthletes.inactive.length +                    <p className="text-sm text-gray-500">

      filteredAthletes.pending.length +                      Requested by {requesterName || "Unknown"}

      filteredAthletes.transferred.length,                      {requestDate ? ` on ${requestDate}` : ""}

    [                    </p>

      filteredAthletes.active.length,                    {request.reason ? (

      filteredAthletes.inactive.length,                      <p className="text-sm text-gray-500">

      filteredAthletes.pending.length,                        Reason: {request.reason}

      filteredAthletes.transferred.length,                      </p>

    ]                    ) : null}

  );                  </div>

                  {permissions.canApproveDeletions ? (

  if (!detailEndpointId) {                    <div className="flex gap-2">

    return (                      <Button

      <div className="max-w-5xl mx-auto py-14 px-4">                        size="sm"

        <p className="text-center text-slate-600">                        variant="outline"

          Club information is not available for this account.                        onClick={() =>

        </p>                          handleDeletionDecision(request._id, "reject")

        <div className="mt-6 text-center">                        }

          <Button onClick={() => navigate(-1)}>Go Back</Button>                      >

        </div>                        Reject

      </div>                      </Button>

    );                      <Button

  }                        size="sm"

                        variant="destructive"

  if (loading && !club) {                        onClick={() =>

    return (                          handleDeletionDecision(request._id, "approve")

      <div className="flex min-h-screen items-center justify-center bg-slate-50">                        }

        <div className="space-y-3 text-center">                      >

          <div className="mx-auto h-12 w-12 animate-spin rounded-full border-2 border-slate-200 border-t-slate-500" />                        Approve & Delete

          <p className="text-sm text-slate-500">Loading club details...</p>                      </Button>

        </div>                    </div>

      </div>                  ) : (

    );                    <span className="text-sm text-gray-500">

  }                      Awaiting administrator confirmation

                    </span>

  return (                  )}

    <div className="min-h-screen bg-slate-50">                </div>

      <div className="mx-auto max-w-[1400px] space-y-8 p-6">              );

        <div className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">            })}

          <div className="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">          </div>

            <div className="flex items-start gap-5">        </section>

              <ClubLogoPreview      )}

                name={club?.name}

                code={club?.code}      {permissions.canDecideTransfers && pendingTransfers.length > 0 && (

                logoUrl={club?.logoUrl}        <section className="space-y-4">

              />          <h2 className="text-xl font-semibold text-gray-800">

              <div className="space-y-4">            Pending Transfer Requests

                <div>          </h2>

                  <h1 className="text-3xl font-semibold text-slate-900">          <div className="bg-white rounded-lg shadow divide-y">

                    {club?.name || "Club"}            {pendingTransfers.map((request) => (

                  </h1>              <div

                  {club?.nameAr ? (                key={request._id}

                    <p className="text-sm text-slate-500">{club.nameAr}</p>                className="p-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between"

                  ) : null}              >

                </div>                <div>

                <div className="flex flex-wrap items-center gap-2">                  <p className="font-medium text-gray-900">

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">                    {request.athlete?.firstName} {request.athlete?.lastName} –

                    {typeLabel}                    License {request.athlete?.licenseNumber || "—"}

                  </span>                  </p>

                  <span                  <p className="text-sm text-gray-500">

                    className={`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${clubStatusClasses}`}                    From {request.fromClub?.name || "Unknown"} to {""}

                  >                    {request.toClub?.name || "Unknown"}

                    {club?.isActive ? "Active" : "Inactive"}                  </p>

                  </span>                </div>

                  <span className="inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">                <div className="flex gap-2">

                    {totalAthletes} total athletes                  <Button

                  </span>                    size="sm"

                  <span className="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-600">                    variant="outline"

                    {activeRate}% active rate                    onClick={() =>

                  </span>                      handleTransferDecision(request._id, "reject")

                </div>                    }

              </div>                  >

            </div>                    Reject

            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">                  </Button>

              <DetailItem label="Club Code">{club?.code}</DetailItem>                  <Button

              <DetailItem label="Email">                    size="sm"

                {club?.email ? (                    onClick={() =>

                  <a                      handleTransferDecision(request._id, "approve")

                    href={`mailto:${club.email}`}                    }

                    className="text-blue-600 hover:underline"                  >

                  >                    Approve

                    {club.email}                  </Button>

                  </a>                </div>

                ) : null}              </div>

              </DetailItem>            ))}

              <DetailItem label="Phone">{club?.phone}</DetailItem>          </div>

              <DetailItem label="City">{club?.city}</DetailItem>        </section>

              <DetailItem label="Address">      )}

                {club?.address ? (

                  <span className="block break-words">{club.address}</span>      {editingAthlete && (

                ) : null}        <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">

              </DetailItem>          <div className="w-full max-w-3xl rounded-lg bg-white shadow-xl">

              <DetailItem label="Parent Club">            <div className="flex items-center justify-between border-b px-6 py-4">

                {parentClubDisplay ? (              <h3 className="text-lg font-semibold text-gray-900">

                  <span className="flex flex-wrap items-center gap-2">                Edit {editingAthlete.fullName || "Athlete"}

                    <span>{parentClubDisplay}</span>              </h3>

                    {parentClubIsActive !== null ? (              <button

                      <span                type="button"

                        className={`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${parentClubIsActive ? "bg-emerald-100 text-emerald-700" : "bg-slate-100 text-slate-600"}`}                onClick={closeEditDialog}

                      >                className="text-2xl leading-none text-gray-500 hover:text-gray-700"

                        {parentClubIsActive ? "Active" : "Inactive"}              >

                      </span>                ×

                    ) : null}              </button>

                  </span>            </div>

                ) : "—"}            <form className="space-y-6 px-6 py-5" onSubmit={handleEditSubmit}>

              </DetailItem>              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">

              <DetailItem label="Primary Contact">{contactName}</DetailItem>                <div className="space-y-2">

              <DetailItem label="Contact Phone">{contactPhone}</DetailItem>                  <Label htmlFor="edit-athlete-firstName">First Name</Label>

              <DetailItem label="Season Activation">                  <Input

                {seasonActivationSummary || "—"}                    id="edit-athlete-firstName"

              </DetailItem>                    value={editForm.firstName}

            </div>                    onChange={(event) =>

          </div>                      updateEditFormField("firstName", event.target.value)

          <div className="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-4">                    }

            {membershipSummaryCards.map((card) => (                    required

              <div                  />

                key={card.key}                </div>

                className={`rounded-2xl border ${card.cardClasses} p-5 shadow-sm`}                <div className="space-y-2">

              >                  <Label htmlFor="edit-athlete-lastName">Last Name</Label>

                <p className="text-sm font-medium text-slate-600">                  <Input

                  {card.label}                    id="edit-athlete-lastName"

                </p>                    value={editForm.lastName}

                <div className="mt-3 flex items-end gap-2">                    onChange={(event) =>

                  <span className="text-3xl font-semibold text-slate-900">                      updateEditFormField("lastName", event.target.value)

                    {card.count}                    }

                  </span>                    required

                  <span className="text-xs text-slate-500">                  />

                    {card.percent}% of roster                </div>

                  </span>                <div className="space-y-2">

                </div>                  <Label htmlFor="edit-athlete-firstNameAr">

                <div className="mt-4 h-2 rounded-full bg-white/70">                    First Name (Arabic)

                  <div                  </Label>

                    className={`h-full rounded-full ${card.badgeClasses}`}                  <Input

                    style={{ width: `${card.percent}%` }}                    id="edit-athlete-firstNameAr"

                  />                    value={editForm.firstNameAr}

                </div>                    onChange={(event) =>

              </div>                      updateEditFormField("firstNameAr", event.target.value)

            ))}                    }

          </div>                    required

          <div className="mt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">                  />

            <p className="text-sm text-slate-500">                </div>

              Displaying {displayedAthletesCount} of {totalAthletes} athletes                <div className="space-y-2">

              across all statuses.                  <Label htmlFor="edit-athlete-lastNameAr">

            </p>                    Last Name (Arabic)

            <div className="flex flex-col gap-3 sm:flex-row sm:items-center">                  </Label>

              <Input                  <Input

                placeholder="Search athletes by name, license, CIN..."                    id="edit-athlete-lastNameAr"

                value={searchTerm}                    value={editForm.lastNameAr}

                onChange={(event) => setSearchTerm(event.target.value)}                    onChange={(event) =>

                className="w-full sm:w-72"                      updateEditFormField("lastNameAr", event.target.value)

              />                    }

              <Button                    required

                variant="outline"                  />

                onClick={() => loadClubDetails()}                </div>

                disabled={loading}              </div>

              >

                Refresh              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">

              </Button>                <div className="space-y-2">

            </div>                  <Label htmlFor="edit-athlete-birthDate">Birth Date</Label>

          </div>                  <Input

        </div>                    id="edit-athlete-birthDate"

                    type="date"

        {athleteSections.map((section) => (                    value={editForm.birthDate}

          <section key={section.key} className="space-y-4">                    onChange={(event) =>

            <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">                      updateEditFormField("birthDate", event.target.value)

              <div className="flex items-center gap-3">                    }

                <h2 className="text-xl font-semibold text-slate-900">                  />

                  {section.title}                </div>

                </h2>                <div className="space-y-2">

                <span                  <Label htmlFor="edit-athlete-gender">Gender</Label>

                  className={`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold text-white ${section.badgeClasses}`}                  <Select

                >                    id="edit-athlete-gender"

                  {section.count} total                    value={editForm.gender}

                </span>                    onChange={(event) =>

              </div>                      updateEditFormField("gender", event.target.value)

              <span className="text-sm text-slate-500">                    }

                {section.data.length} shown                  >

              </span>                    <option value="">Select gender</option>

            </div>                    <option value="male">Male</option>

            <div className="rounded-3xl border border-slate-200 bg-white p-3 shadow-sm">                    <option value="female">Female</option>

              <DataGrid                  </Select>

                data={section.data}                </div>

                columns={baseColumns}                <div className="space-y-2">

                gridId={section.gridId}                  <Label htmlFor="edit-athlete-cin">CIN</Label>

                loading={loading}                  <Input

                emptyMessage={section.emptyMessage}                    id="edit-athlete-cin"

              />                    value={editForm.cin}

            </div>                    onChange={(event) =>

          </section>                      updateEditFormField("cin", event.target.value)

        ))}                    }

                    placeholder="Optional"

        {pendingDeletionRequests.length > 0 && (                  />

          <section className="space-y-4">                </div>

            <div className="flex items-center gap-3">              </div>

              <h2 className="text-xl font-semibold text-slate-900">

                Pending Deletion Requests              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">

              </h2>                <div className="space-y-2">

              <span className="inline-flex items-center rounded-full bg-amber-500 px-3 py-1 text-xs font-semibold text-white">                  <Label htmlFor="edit-athlete-passport">Passport Number</Label>

                {pendingDeletionRequests.length}                  <Input

              </span>                    id="edit-athlete-passport"

            </div>                    value={editForm.passportNumber}

            <div className="divide-y divide-amber-100 rounded-3xl border border-amber-200 bg-amber-50 shadow-sm">                    onChange={(event) =>

              {pendingDeletionRequests.map((request) => {                      updateEditFormField("passportNumber", event.target.value)

                const requestDate = formatDisplayDate(request.createdAt);                    }

                const requesterName = request.requestedBy                    placeholder="Optional"

                  ? `${request.requestedBy.firstName ?? ""} ${                  />

                      request.requestedBy.lastName ?? ""                </div>

                    }`.trim()                {isAdmin ? (

                  : "Unknown";                  <div className="space-y-2">

                    <Label htmlFor="edit-athlete-club">Club</Label>

                return (                    <Select

                  <div                      id="edit-athlete-club"

                    key={request._id}                      value={editForm.clubId}

                    className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"                      onChange={(event) =>

                  >                        updateEditFormField("clubId", event.target.value)

                    <div className="space-y-1">                      }

                      <p className="font-medium text-slate-900">                      required

                        {request.athlete?.firstName} {request.athlete?.lastName} –                    >

                        License {request.athlete?.licenseNumber || "—"}                      <option value="">Select club</option>

                      </p>                      {clubOptions.map((option) => (

                      <p className="text-sm text-slate-600">                        <option key={option.value} value={option.value}>

                        Requested by {requesterName || "Unknown"}                          {option.label}

                        {requestDate ? ` on ${requestDate}` : ""}                        </option>

                      </p>                      ))}

                      {request.reason ? (                    </Select>

                        <p className="text-sm text-slate-600">                    <p className="text-xs text-gray-500">

                          Reason: {request.reason}                      Changing the club reassigns the athlete immediately.

                        </p>                    </p>

                      ) : null}                  </div>

                    </div>                ) : (

                    {permissions.canApproveDeletions ? (                  <div className="space-y-1 text-sm">

                      <div className="flex gap-2">                    <span className="font-medium text-gray-700">Club</span>

                        <Button                    <p className="text-gray-600">

                          size="sm"                      {club?.name || editingAthlete.membershipClubName || "—"}

                          variant="outline"                    </p>

                          onClick={() =>                  </div>

                            handleDeletionDecision(request._id, "reject")                )}

                          }              </div>

                        >

                          Reject              <div className="flex items-center justify-end gap-3">

                        </Button>                <Button

                        <Button                  type="button"

                          size="sm"                  variant="outline"

                          variant="destructive"                  onClick={closeEditDialog}

                          onClick={() =>                  disabled={editSubmitting}

                            handleDeletionDecision(request._id, "approve")                >

                          }                  Cancel

                        >                </Button>

                          Approve & Delete                <Button type="submit" disabled={editSubmitting}>

                        </Button>                  {editSubmitting ? "Saving..." : "Save Changes"}

                      </div>                </Button>

                    ) : (              </div>

                      <span className="text-sm text-slate-600">            </form>

                        Awaiting administrator confirmation          </div>

                      </span>        </div>

                    )}      )}

                  </div>

                );      {transferDialog.isOpen && (

              })}        <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

            </div>          <div className="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 space-y-4">

          </section>            <div className="flex items-center justify-between">

        )}              <h3 className="text-lg font-semibold text-gray-900">

                Transfer {transferDialog.athlete?.fullName}

        {permissions.canDecideTransfers && pendingTransfers.length > 0 && (              </h3>

          <section className="space-y-4">              <button

            <div className="flex items-center gap-3">                type="button"

              <h2 className="text-xl font-semibold text-slate-900">                onClick={closeTransferDialog}

                Pending Transfer Requests                className="text-2xl leading-none text-gray-500 hover:text-gray-700"

              </h2>              >

              <span className="inline-flex items-center rounded-full bg-indigo-500 px-3 py-1 text-xs font-semibold text-white">                ×

                {pendingTransfers.length}              </button>

              </span>            </div>

            </div>            <form className="space-y-4" onSubmit={handleTransferSubmit}>

            <div className="divide-y divide-indigo-100 rounded-3xl border border-indigo-200 bg-indigo-50 shadow-sm">              <div className="space-y-2">

              {pendingTransfers.map((request) => (                <label className="text-sm font-medium text-gray-700">

                <div                  Target Club

                  key={request._id}                </label>

                  className="flex flex-col gap-3 p-5 lg:flex-row lg:items-center lg:justify-between"                <Select

                >                  value={transferDialog.targetClubId}

                  <div className="space-y-1">                  onChange={(event) =>

                    <p className="font-medium text-slate-900">                    setTransferDialog((prev) => ({

                      {request.athlete?.firstName} {request.athlete?.lastName} –                      ...prev,

                      License {request.athlete?.licenseNumber || "—"}                      targetClubId: event.target.value,

                    </p>                    }))

                    <p className="text-sm text-slate-600">                  }

                      From {request.fromClub?.name || "Unknown"} to {""}                  required

                      {request.toClub?.name || "Unknown"}                >

                    </p>                  <option value="">Select club</option>

                  </div>                  {clubs

                  <div className="flex gap-2">                    .filter((clubItem) => clubItem._id !== club?._id)

                    <Button                    .map((clubItem) => (

                      size="sm"                      <option key={clubItem._id} value={clubItem._id}>

                      variant="outline"                        {clubItem.name}

                      onClick={() =>                      </option>

                        handleTransferDecision(request._id, "reject")                    ))}

                      }                </Select>

                    >              </div>

                      Reject              <div className="space-y-2">

                    </Button>                <label className="text-sm font-medium text-gray-700">

                    <Button                  Notes (optional)

                      size="sm"                </label>

                      onClick={() =>                <textarea

                        handleTransferDecision(request._id, "approve")                  className="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black"

                      }                  rows="3"

                    >                  value={transferDialog.note}

                      Approve                  onChange={(event) =>

                    </Button>                    setTransferDialog((prev) => ({

                  </div>                      ...prev,

                </div>                      note: event.target.value,

              ))}                    }))

            </div>                  }

          </section>                  placeholder="Reason for transfer or additional details"

        )}                />

      </div>              </div>

              <div className="flex items-center justify-end gap-3">

      {transferDialog.isOpen ? (                <Button

        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">                  type="button"

          <div className="w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl">                  variant="outline"

            <div className="mb-4 flex items-center justify-between">                  onClick={closeTransferDialog}

              <h2 className="text-lg font-semibold text-slate-900">                  disabled={transferDialog.submitting}

                Transfer Athlete                >

              </h2>                  Cancel

              <button                </Button>

                type="button"                <Button type="submit" disabled={transferDialog.submitting}>

                onClick={closeTransferDialog}                  {transferDialog.submitting ? "Submitting..." : "Submit"}

                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"                </Button>

                aria-label="Close"              </div>

              >            </form>

                ×          </div>

              </button>        </div>

            </div>      )}

            <form onSubmit={handleTransferSubmit} className="space-y-4">

              <div>      {deleteDialog.isOpen && (

                <Label>Athlete</Label>        <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

                <p className="text-sm text-slate-700">          <div className="bg-white rounded-lg shadow-xl w-full max-w-md p-6 space-y-4">

                  {transferDialog.athlete?.fullName || "Unnamed athlete"}            <div className="flex items-center justify-between">

                </p>              <h3 className="text-lg font-semibold text-gray-900">

              </div>                Request deletion for {deleteDialog.athlete?.fullName}

              <div className="space-y-2">              </h3>

                <Label htmlFor="transfer-target">Target Club</Label>              <button

                <Select                type="button"

                  id="transfer-target"                onClick={closeDeleteDialog}

                  value={transferDialog.targetClubId}                className="text-2xl leading-none text-gray-500 hover:text-gray-700"

                  onChange={(event) =>              >

                    setTransferDialog((previous) => ({                ×

                      ...previous,              </button>

                      targetClubId: event.target.value,            </div>

                    }))            <form className="space-y-4" onSubmit={handleDeleteRequestSubmit}>

                  }              <p className="text-sm text-gray-600">

                  required                This sends a deletion request to the federation administrator.

                >                The athlete will only be removed once the request is approved.

                  <option value="">Select club</option>              </p>

                  {clubs              <div className="space-y-2">

                    .filter((entry) => entry._id !== club?._id)                <label className="text-sm font-medium text-gray-700">

                    .map((entry) => (                  Reason (optional)

                      <option key={entry._id} value={entry._id}>                </label>

                        {entry.name}                <textarea

                      </option>                  className="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black"

                    ))}                  rows="3"

                </Select>                  value={deleteDialog.reason}

              </div>                  onChange={(event) =>

              <div className="space-y-2">                    setDeleteDialog((prev) => ({

                <Label htmlFor="transfer-note">Notes</Label>                      ...prev,

                <textarea                      reason: event.target.value,

                  id="transfer-note"                    }))

                  rows={3}                  }

                  className="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40"                  placeholder="Add context for the administrator"

                  value={transferDialog.note}                />

                  onChange={(event) =>              </div>

                    setTransferDialog((previous) => ({              <div className="flex items-center justify-end gap-3">

                      ...previous,                <Button

                      note: event.target.value,                  type="button"

                    }))                  variant="outline"

                  }                  onClick={closeDeleteDialog}

                  placeholder="Optional context for the receiving club"                  disabled={deleteDialog.submitting}

                />                >

              </div>                  Cancel

              <div className="flex justify-end gap-2">                </Button>

                <Button type="button" variant="outline" onClick={closeTransferDialog}>                <Button

                  Cancel                  type="submit"

                </Button>                  variant="destructive"

                <Button type="submit" disabled={transferDialog.submitting}>                  disabled={deleteDialog.submitting}

                  {transferDialog.submitting ? "Submitting..." : "Submit Transfer"}                >

                </Button>                  {deleteDialog.submitting ? "Sending..." : "Submit Request"}

              </div>                </Button>

            </form>              </div>

          </div>            </form>

        </div>          </div>

      ) : null}        </div>

      )}

      {deleteDialog.isOpen ? (

        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">      {loading && (

          <div className="w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl">        <div className="fixed inset-0 bg-white/40 backdrop-blur-sm flex items-center justify-center z-40">

            <div className="mb-4 flex items-center justify-between">          <div className="bg-white shadow-lg rounded-lg px-6 py-4">

              <h2 className="text-lg font-semibold text-slate-900">            <p className="text-gray-700">Loading club data...</p>

                Request Athlete Deletion          </div>

              </h2>        </div>

              <button      )}

                type="button"    </div>

                onClick={closeDeleteDialog}  );

                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"};

                aria-label="Close"

              >export default ClubDetail;

                ×
              </button>
            </div>
            <form onSubmit={handleDeleteRequestSubmit} className="space-y-4">
              <div>
                <Label>Athlete</Label>
                <p className="text-sm text-slate-700">
                  {deleteDialog.athlete?.fullName || "Unnamed athlete"}
                </p>
              </div>
              <div className="space-y-2">
                <Label htmlFor="delete-reason">Reason</Label>
                <textarea
                  id="delete-reason"
                  rows={4}
                  className="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40"
                  value={deleteDialog.reason}
                  onChange={(event) =>
                    setDeleteDialog((previous) => ({
                      ...previous,
                      reason: event.target.value,
                    }))
                  }
                  placeholder="Provide context for the administrator (optional)"
                />
              </div>
              <div className="flex justify-end gap-2">
                <Button type="button" variant="outline" onClick={closeDeleteDialog}>
                  Cancel
                </Button>
                <Button type="submit" disabled={deleteDialog.submitting}>
                  {deleteDialog.submitting ? "Submitting..." : "Submit Request"}
                </Button>
              </div>
            </form>
          </div>
        </div>
      ) : null}

      {editingAthlete ? (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 p-4">
          <div className="w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl">
            <div className="mb-4 flex items-center justify-between">
              <h2 className="text-lg font-semibold text-slate-900">
                Edit Athlete
              </h2>
              <button
                type="button"
                onClick={closeEditDialog}
                className="text-2xl leading-none text-slate-400 transition hover:text-slate-600"
                aria-label="Close"
              >
                ×
              </button>
            </div>
            <form onSubmit={handleEditSubmit} className="space-y-5">
              <div className="grid gap-4 sm:grid-cols-2">
                <div className="space-y-2">
                  <Label htmlFor="edit-first-name">First Name</Label>
                  <Input
                    id="edit-first-name"
                    value={editForm.firstName}
                    onChange={(event) =>
                      updateEditFormField("firstName", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-last-name">Last Name</Label>
                  <Input
                    id="edit-last-name"
                    value={editForm.lastName}
                    onChange={(event) =>
                      updateEditFormField("lastName", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-first-name-ar">First Name (Arabic)</Label>
                  <Input
                    id="edit-first-name-ar"
                    value={editForm.firstNameAr}
                    onChange={(event) =>
                      updateEditFormField("firstNameAr", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-last-name-ar">Last Name (Arabic)</Label>
                  <Input
                    id="edit-last-name-ar"
                    value={editForm.lastNameAr}
                    onChange={(event) =>
                      updateEditFormField("lastNameAr", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-birthdate">Birth Date</Label>
                  <Input
                    id="edit-birthdate"
                    type="date"
                    value={editForm.birthDate}
                    onChange={(event) =>
                      updateEditFormField("birthDate", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-gender">Gender</Label>
                  <Select
                    id="edit-gender"
                    value={editForm.gender}
                    onChange={(event) =>
                      updateEditFormField("gender", event.target.value)
                    }
                  >
                    <option value="">Select gender</option>
                    <option value="homme">Male</option>
                    <option value="femme">Female</option>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-cin">CIN</Label>
                  <Input
                    id="edit-cin"
                    value={editForm.cin}
                    onChange={(event) =>
                      updateEditFormField("cin", event.target.value)
                    }
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="edit-passport">Passport Number</Label>
                  <Input
                    id="edit-passport"
                    value={editForm.passportNumber}
                    onChange={(event) =>
                      updateEditFormField("passportNumber", event.target.value)
                    }
                  />
                </div>
                {isAdmin ? (
                  <div className="space-y-2 sm:col-span-2">
                    <Label htmlFor="edit-club">Club Assignment</Label>
                    <Select
                      id="edit-club"
                      value={editForm.clubId}
                      onChange={(event) =>
                        updateEditFormField("clubId", event.target.value)
                      }
                    >
                      <option value="">Keep current club</option>
                      {clubs.map((entry) => (
                        <option key={entry._id} value={entry._id}>
                          {entry.name}
                        </option>
                      ))}
                    </Select>
                    <p className="text-xs text-slate-500">
                      Administrators can move the athlete to another club while updating profile details.
                    </p>
                  </div>
                ) : null}
              </div>

              <div className="flex justify-end gap-2">
                <Button type="button" variant="outline" onClick={closeEditDialog}>
                  Cancel
                </Button>
                <Button type="submit" disabled={editSubmitting}>
                  {editSubmitting ? "Saving..." : "Save Changes"}
                </Button>
              </div>
            </form>
          </div>
        </div>
      ) : null}
    </div>
  );
};

export default ClubDetail;
